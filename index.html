<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml" />






<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale">
<meta property="article:author" content="dly">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/"/>





  <title>Hexo</title>
  








<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            å…³äº
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/01/11/MyISAM%E8%A1%A8%E9%94%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/01/11/MyISAM%E8%A1%A8%E9%94%81/" itemprop="url">MyISAMè¡¨é”</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2022-01-11T17:14:56+08:00">
                2022-01-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>é˜¿æ–¯å…°è§£æ”¾å•¦å°±ç®—äº†</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/07/02/%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/07/02/%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3/" itemprop="url">å‡½æ•°å¼æ¥å£</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-07-02T16:11:41+08:00">
                2021-07-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop="url" rel="index">
                    <span itemprop="name">éšç¬”</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="å‡½æ•°å¼æ¥å£"><a href="#å‡½æ•°å¼æ¥å£" class="headerlink" title="å‡½æ•°å¼æ¥å£"></a>å‡½æ•°å¼æ¥å£</h4><blockquote>
<p>æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£å°±æ˜¯å‡½æ•°å¼æ¥å£</p>
</blockquote>
<h4 id="å¸¸ç”¨å‡½æ•°å¼æ¥å£"><a href="#å¸¸ç”¨å‡½æ•°å¼æ¥å£" class="headerlink" title="å¸¸ç”¨å‡½æ•°å¼æ¥å£"></a>å¸¸ç”¨å‡½æ•°å¼æ¥å£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Converter</span>&lt;<span class="title">S</span>, <span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="function">T <span class="title">convert</span><span class="params">(S source)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¯­ä¹‰ æ¥æ”¶ä¸€ä¸ªSç±»å‹çš„å‚æ•°è¿”å›ä¸€ä¸ªTç±»å‹çš„ç»“æœï¼Œç±»ä¼¼äºStreamä¸­çš„mapæ“ä½œ</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/06/30/%E4%B9%A6%E5%8D%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/06/30/%E4%B9%A6%E5%8D%95/" itemprop="url">ä¹¦å•</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-06-30T15:20:42+08:00">
                2021-06-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop="url" rel="index">
                    <span itemprop="name">éšç¬”</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>å¤©ä¸‹ç†™ç†™çš†ä¸ºåˆ©æ¥ï¼Œå¤©ä¸‹æ”˜æ”˜çš†ä¸ºåˆ©å¾€ã€‚</p>
<p>ä¹¦ç±æ˜¯äººç±»è¿›æ­¥çš„é˜¶æ¢¯ã€‚</p>
<p>ä¸ºäº†æ˜å¤©ï¼Œå¹²æ¯ğŸ»</p>
<p>æˆ‘ä¹Ÿè¦å†™å‡ºå¼ºæ‚çš„ä»£ç ï¼</p>
<h4 id="æˆ‘çš„ä¹¦å•"><a href="#æˆ‘çš„ä¹¦å•" class="headerlink" title="æˆ‘çš„ä¹¦å•"></a>æˆ‘çš„ä¹¦å•</h4><h5 id="æŠ€æœ¯åºåˆ—"><a href="#æŠ€æœ¯åºåˆ—" class="headerlink" title="æŠ€æœ¯åºåˆ—"></a>æŠ€æœ¯åºåˆ—</h5><h6 id="Java-8å®æˆ˜"><a href="#Java-8å®æˆ˜" class="headerlink" title="Java 8å®æˆ˜"></a>Java 8å®æˆ˜</h6><blockquote>
<p>å¯¹java8ä¸­çš„æ–°ç‰¹æ€§ä»‹ç»çš„éå¸¸å…¨é¢ï¼Œå°¤å…¶æ˜¯lamdbaè¡¨è¾¾å¼å’Œæµçš„æ“ä½œã€‚å¦å¤–å…³äºæ—¥æœŸçš„APIï¼Œå¼‚æ­¥ç¼–ç¨‹ï¼ŒOptionalï¼Œå‡½æ•°å¼ç¼–ç¨‹ç­‰ä¹Ÿå¯¹æ—¥å¸¸å¼€å‘ä¸­æœ‰å¾ˆå¼ºçš„å€Ÿé‰´ä½œç”¨ã€‚</p>
</blockquote>
<h6 id="Javaæ€§èƒ½æƒå¨æŒ‡å—-Java-Performance-The-Definitive-Guide"><a href="#Javaæ€§èƒ½æƒå¨æŒ‡å—-Java-Performance-The-Definitive-Guide" class="headerlink" title="Javaæ€§èƒ½æƒå¨æŒ‡å—|Java Performance: The Definitive Guide"></a>Javaæ€§èƒ½æƒå¨æŒ‡å—|Java Performance: The Definitive Guide</h6><h6 id="å®æˆ˜Javaé«˜å¹¶å‘ç¨‹åºè®¾è®¡-è‘›ä¸€é¸£"><a href="#å®æˆ˜Javaé«˜å¹¶å‘ç¨‹åºè®¾è®¡-è‘›ä¸€é¸£" class="headerlink" title="å®æˆ˜Javaé«˜å¹¶å‘ç¨‹åºè®¾è®¡|è‘›ä¸€é¸£"></a>å®æˆ˜Javaé«˜å¹¶å‘ç¨‹åºè®¾è®¡|è‘›ä¸€é¸£</h6><h6 id="avaå¹¶å‘ç¼–ç¨‹å®æˆ˜"><a href="#avaå¹¶å‘ç¼–ç¨‹å®æˆ˜" class="headerlink" title="avaå¹¶å‘ç¼–ç¨‹å®æˆ˜"></a>avaå¹¶å‘ç¼–ç¨‹å®æˆ˜</h6><h6 id="Effective-Javaä¸­æ–‡ç‰ˆï¼ˆç¬¬3ç‰ˆï¼‰-Effective-Java-Third-Edition"><a href="#Effective-Javaä¸­æ–‡ç‰ˆï¼ˆç¬¬3ç‰ˆï¼‰-Effective-Java-Third-Edition" class="headerlink" title="Effective Javaä¸­æ–‡ç‰ˆï¼ˆç¬¬3ç‰ˆï¼‰|Effective Java Third Edition"></a>Effective Javaä¸­æ–‡ç‰ˆï¼ˆç¬¬3ç‰ˆï¼‰|Effective Java Third Edition</h6><h6 id="æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼ˆç¬¬3ç‰ˆï¼‰-å‘¨å¿—æ˜"><a href="#æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼ˆç¬¬3ç‰ˆï¼‰-å‘¨å¿—æ˜" class="headerlink" title="æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼ˆç¬¬3ç‰ˆï¼‰| å‘¨å¿—æ˜"></a>æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼ˆç¬¬3ç‰ˆï¼‰| å‘¨å¿—æ˜</h6><h6 id="Javaè™šæ‹Ÿæœºè§„èŒƒï¼ˆJava-SE-8ç‰ˆï¼‰-çˆ±é£ç¿”ã€å‘¨å¿—æ˜"><a href="#Javaè™šæ‹Ÿæœºè§„èŒƒï¼ˆJava-SE-8ç‰ˆï¼‰-çˆ±é£ç¿”ã€å‘¨å¿—æ˜" class="headerlink" title="Javaè™šæ‹Ÿæœºè§„èŒƒï¼ˆJava SE 8ç‰ˆï¼‰|çˆ±é£ç¿”ã€å‘¨å¿—æ˜"></a>Javaè™šæ‹Ÿæœºè§„èŒƒï¼ˆJava SE 8ç‰ˆï¼‰|çˆ±é£ç¿”ã€å‘¨å¿—æ˜</h6><h6 id="MySQLå¿…çŸ¥å¿…ä¼š"><a href="#MySQLå¿…çŸ¥å¿…ä¼š" class="headerlink" title="MySQLå¿…çŸ¥å¿…ä¼š"></a>MySQLå¿…çŸ¥å¿…ä¼š</h6><h6 id="é«˜æ€§èƒ½MySQL"><a href="#é«˜æ€§èƒ½MySQL" class="headerlink" title="é«˜æ€§èƒ½MySQL"></a>é«˜æ€§èƒ½MySQL</h6><h6 id="Redisè®¾è®¡ä¸å®ç°-é»„å¥å®"><a href="#Redisè®¾è®¡ä¸å®ç°-é»„å¥å®" class="headerlink" title="Redisè®¾è®¡ä¸å®ç°|é»„å¥å®"></a>Redisè®¾è®¡ä¸å®ç°|é»„å¥å®</h6><h6 id="Redis-æ·±åº¦å†é™©ï¼šæ ¸å¿ƒåŸç†ä¸åº”ç”¨å®è·µ-é’±æ–‡å“"><a href="#Redis-æ·±åº¦å†é™©ï¼šæ ¸å¿ƒåŸç†ä¸åº”ç”¨å®è·µ-é’±æ–‡å“" class="headerlink" title="Redis æ·±åº¦å†é™©ï¼šæ ¸å¿ƒåŸç†ä¸åº”ç”¨å®è·µ|é’±æ–‡å“"></a>Redis æ·±åº¦å†é™©ï¼šæ ¸å¿ƒåŸç†ä¸åº”ç”¨å®è·µ|é’±æ–‡å“</h6><h6 id="TCP-IPè¯¦è§£-å·1ï¼šåè®®"><a href="#TCP-IPè¯¦è§£-å·1ï¼šåè®®" class="headerlink" title="TCP/IPè¯¦è§£ å·1ï¼šåè®®"></a>TCP/IPè¯¦è§£ å·1ï¼šåè®®</h6><h6 id="æ·±å…¥å‰–æTomcat"><a href="#æ·±å…¥å‰–æTomcat" class="headerlink" title="æ·±å…¥å‰–æTomcat"></a>æ·±å…¥å‰–æTomcat</h6><h6 id="æ¶æ„æ¢é™©åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶-æä¸šå…µ"><a href="#æ¶æ„æ¢é™©åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶-æä¸šå…µ" class="headerlink" title="æ¶æ„æ¢é™©åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶ | æä¸šå…µ"></a>æ¶æ„æ¢é™©åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶ | æä¸šå…µ</h6><h6 id="æ·±å…¥åˆ†æJavaWebæŠ€æœ¯å†…å¹•-è®¸ä»¤æ³¢"><a href="#æ·±å…¥åˆ†æJavaWebæŠ€æœ¯å†…å¹•-è®¸ä»¤æ³¢" class="headerlink" title="æ·±å…¥åˆ†æJavaWebæŠ€æœ¯å†…å¹• | è®¸ä»¤æ³¢"></a>æ·±å…¥åˆ†æJavaWebæŠ€æœ¯å†…å¹• | è®¸ä»¤æ³¢</h6><blockquote>
<p>javaç¼–è¯‘åŸç†ã€ Servletå·¥ä½œåŸç†ã€ Tomcatã€springå’ŒiBatisè¿™å‡ ç« çš„æ”¶è·å¾ˆå¤§ã€‚</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/06/29/sqlUtil/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/06/29/sqlUtil/" itemprop="url">sqlUtil</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-06-29T15:30:05+08:00">
                2021-06-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop="url" rel="index">
                    <span itemprop="name">éšç¬”</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SqlUtil</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * å°†å®ä½“ç±»çš„listè½¬ä¸ºæ‰¹é‡æ’å…¥çš„sql</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">convertDOListToInsertSql</span><span class="params">(List&lt;T&gt; doList, Class&lt;T&gt; tclass)</span> <span class="keyword">throws</span> IllegalAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (doList == <span class="keyword">null</span> || doList.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        StringBuilder sql = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">         <span class="comment">// é€šè¿‡åå°„å›å»å®ä½“ç±»å¯¹åº”çš„è¡¨åå’Œå­—æ®µå</span></span><br><span class="line">        Table tableAnnotation = tclass.getAnnotation(Table.class);</span><br><span class="line">         <span class="comment">// å¦‚æœæ²¡æœ‰tableæ³¨è§£ï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">if</span> (tableAnnotation == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(tclass.getSimpleName() + <span class="string">&quot;æ²¡æœ‰å¯¹åº”çš„æ•°æ®åº“è¡¨&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String tableName = tableAnnotation.name();</span><br><span class="line">        Field[] fields = tclass.getDeclaredFields();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// è·å–æ•°æ®åº“åˆ—åå’Œå®ä½“ç±»å­—æ®µåå¯¹åº”å…³ç³»</span></span><br><span class="line">        List&lt;String&gt; columnNameList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">            field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            String columnName = getColumnNameByField(field);</span><br><span class="line">            columnNameList.add(columnName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// æ‹¼æ¥sql</span></span><br><span class="line">        sql.append(<span class="string">&quot;INSERT INTO &quot;</span>).append(tableName).append(<span class="string">&quot; (&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; columnNameList.size(); i++) &#123;</span><br><span class="line">            sql.append(columnNameList.get(i));</span><br><span class="line">            <span class="keyword">if</span> (i &lt; (columnNameList.size() - <span class="number">1</span>))&#123;</span><br><span class="line">                sql.append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        sql.append(<span class="string">&quot;) VALUES &quot;</span>);</span><br><span class="line">         <span class="comment">// æ‹¼æ¥å­—æ®µå€¼ï¼ŒStringéœ€è¦åŠ å•å¼•å·ï¼Œå¸ƒå°”éœ€è¦è½¬æ¢æˆ1å’Œ0ï¼Œæ•°å­—ç±»å‹ä¿æŒä¸å˜ï¼Œå…¶ä»–ç±»å‹æš‚ä¸æ”¯æŒ</span></span><br><span class="line">         <span class="comment">// <span class="doctag">TODO:</span> æ—¥æœŸç±»å‹å’‹åŠï¼Ÿæšä¸¾ç±»å‹å’‹åŠï¼Ÿ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; doList.size(); i++) &#123;</span><br><span class="line">            T entity = doList.get(i);</span><br><span class="line">            sql.append(<span class="string">&quot;(&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; fields.length; j++) &#123;</span><br><span class="line">                Field field = fields[j];</span><br><span class="line">                <span class="keyword">if</span> (field.get(entity) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    sql.append(<span class="string">&quot;NULL&quot;</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (field.getType().getName().equals(<span class="string">&quot;java.lang.String&quot;</span>)) &#123;</span><br><span class="line">                        <span class="comment">// å¦‚æœè¾“å…¥å­—ç¬¦ä¸²ä¸­ä»¥&#x27;æ‰“æ–­ï¼Œå³å¯è‡ªè¡Œè¾“å…¥åç»­sqlå†…å®¹ï¼Œå­˜åœ¨sqlæ³¨å…¥é£é™©ï¼Œä¸´æ—¶ä¿®æ”¹æ–¹æ¡ˆ</span></span><br><span class="line">                        String sfield = (String) field.get(entity);</span><br><span class="line">                        sql.append(<span class="string">&quot;&#x27;&quot;</span>).append(sfield.replace(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;&quot;</span>)).append(<span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (field.getType().getName().equals(<span class="string">&quot;java.lang.Boolean&quot;</span>)) &#123;</span><br><span class="line">                        sql.append((Boolean) field.get(entity) ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (field.getType().getName().equals(<span class="string">&quot;java.util.Date&quot;</span>)) &#123;</span><br><span class="line">                        SimpleDateFormat simpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd hh:mm:ss&quot;</span>);</span><br><span class="line">                        String dateString = simpleDateFormat.format((Date) field.get(entity));</span><br><span class="line">                        sql.append(<span class="string">&quot;&#x27;&quot;</span>).append(dateString).append(<span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        sql.append(<span class="string">&quot;&#x27;&quot;</span>).append(field.get(entity)).append(<span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (j &lt; (fields.length - <span class="number">1</span>))&#123;</span><br><span class="line">                    sql.append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            sql.append(<span class="string">&quot;)&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (i &lt; (doList.size() - <span class="number">1</span>))&#123;</span><br><span class="line">                sql.append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sql.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// æ ¹æ®å®ä½“ç±»ä¸­çš„fieldï¼Œè·å–å¯¹åº”åœ¨æ•°æ®åº“ä¸­çš„å­—æ®µå</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getColumnNameByField</span><span class="params">(Field field)</span> </span>&#123;</span><br><span class="line">        Column columnAnnotation = field.getAnnotation(Column.class);</span><br><span class="line">        <span class="keyword">if</span> (columnAnnotation == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// å¦‚æœcolumnæ³¨è§£æœ‰nameå±æ€§çš„è¯ï¼Œnameå±æ€§å°±æ˜¯åˆ—åï¼Œå¦‚æœæ²¡æœ‰nameå±æ€§ï¼Œå°±æ˜¯å­—æ®µåé©¼å³°è½¬ä¸‹æ»‘è´¤</span></span><br><span class="line">        String columnName = columnAnnotation.name();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;&quot;</span>.equals(columnName)) &#123;</span><br><span class="line">            String fieldName = field.getName();</span><br><span class="line">            columnName = CaseFormat.UPPER_CAMEL.to(CaseFormat.LOWER_UNDERSCORE, fieldName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> columnName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/06/15/HttpClient/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/06/15/HttpClient/" itemprop="url">HttpClient</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-06-15T11:19:25+08:00">
                2021-06-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop="url" rel="index">
                    <span itemprop="name">éšç¬”</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_TIMEOUT = <span class="number">30000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CHARSET_UTF8 = <span class="string">&quot;UTF-8&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SSLContext sslContext;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Registry&lt;ConnectionSocketFactory&gt; socketFactoryRegistry;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> PoolingHttpClientConnectionManager connectionManager;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> RequestConfig requestConfig = RequestConfig.custom()</span><br><span class="line">            <span class="comment">// è®¾ç½®è¿æ¥è¶…æ—¶</span></span><br><span class="line">            .setConnectTimeout(MAX_TIMEOUT)</span><br><span class="line">            <span class="comment">// è®¾ç½®è¯»å–è¶…æ—¶</span></span><br><span class="line">            .setSocketTimeout(MAX_TIMEOUT)</span><br><span class="line">            <span class="comment">// è®¾ç½®ä»è¿æ¥æ± è·å–è¿æ¥å®ä¾‹çš„è¶…æ—¶</span></span><br><span class="line">            .setConnectionRequestTimeout(MAX_TIMEOUT)</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sslContext = SSLContext.getInstance(<span class="string">&quot;SSL&quot;</span>);</span><br><span class="line">            sslContext.init(<span class="keyword">null</span>,</span><br><span class="line">                    <span class="keyword">new</span> TrustManager[]&#123;<span class="keyword">new</span> HttpClient.TrustAnyTrustManager()&#125;,</span><br><span class="line">                    <span class="keyword">new</span> SecureRandom());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (KeyManagementException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®åè®®httpå’Œhttpså¯¹åº”çš„å¤„ç†socketé“¾æ¥å·¥å‚çš„å¯¹è±¡</span></span><br><span class="line">        socketFactoryRegistry = RegistryBuilder.&lt;ConnectionSocketFactory&gt;create()</span><br><span class="line">                .register(<span class="string">&quot;http&quot;</span>, PlainConnectionSocketFactory.INSTANCE)</span><br><span class="line">                .register(<span class="string">&quot;https&quot;</span>, <span class="keyword">new</span> SSLConnectionSocketFactory(sslContext))</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        connectionManager = <span class="keyword">new</span> PoolingHttpClientConnectionManager(socketFactoryRegistry);</span><br><span class="line">        connectionManager.setDefaultSocketConfig(SocketConfig.custom().setTcpNoDelay(<span class="keyword">true</span>).build());</span><br><span class="line">        connectionManager.setMaxTotal(<span class="number">300</span>); <span class="comment">// å…¨å¹¶å‘</span></span><br><span class="line">        connectionManager.setDefaultMaxPerRoute(<span class="number">300</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> CloseableHttpClient httpClient = HttpClients.custom()</span><br><span class="line">            .setConnectionManager(connectionManager)</span><br><span class="line">            .setDefaultRequestConfig(requestConfig)</span><br><span class="line">            .setRetryHandler(<span class="keyword">new</span> StandardHttpRequestRetryHandler())</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;Q, T&gt; <span class="function">T <span class="title">doPost</span><span class="params">(RequestInterface reqInterface, Map&lt;String, String&gt; headers, Q requestObject, Class&lt;T&gt; responseClass)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; params = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        String json = JsonUtils.object2Json(requestObject);</span><br><span class="line">        log.info(<span class="string">&quot;requestContent:&#123;&#125;&quot;</span>, json);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            params = JsonUtils.readValue(json, <span class="keyword">new</span> TypeReference&lt;Map&lt;String, String&gt;&gt;() &#123;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;json read value error&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> doPost(reqInterface, headers, params, responseClass);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">doPost</span><span class="params">(RequestInterface reqInterface, Map&lt;String, String&gt; headers, Map&lt;String, String&gt; params, Class&lt;T&gt; responseClass)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        T result = <span class="keyword">null</span>;</span><br><span class="line">        CloseableHttpResponse response = <span class="keyword">null</span>;</span><br><span class="line">        HttpPost httpPost = <span class="keyword">new</span> HttpPost(reqInterface.getUrl());</span><br><span class="line">        <span class="keyword">if</span> (headers != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : headers.entrySet()) &#123;</span><br><span class="line">                httpPost.addHeader(entry.getKey(), entry.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">switch</span> (reqInterface.getRequestType()) &#123;</span><br><span class="line">            <span class="keyword">case</span> FORM:</span><br><span class="line">                List&lt;NameValuePair&gt; pairList = <span class="keyword">new</span> ArrayList&lt;&gt;(params.size());</span><br><span class="line">                params.forEach((key, value) -&gt; &#123;</span><br><span class="line">                    NameValuePair pair = <span class="keyword">new</span> BasicNameValuePair(key, value);</span><br><span class="line">                    pairList.add(pair);</span><br><span class="line">                &#125;);</span><br><span class="line">                httpPost.setEntity(<span class="keyword">new</span> UrlEncodedFormEntity(pairList, Charsets.UTF_8));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> JSON:</span><br><span class="line">                httpPost.addHeader(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">                httpPost.setEntity(<span class="keyword">new</span> StringEntity(JsonUtils.object2Json(params), Charsets.UTF_8));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            response = httpClient.execute(httpPost);</span><br><span class="line">            String respContent = EntityUtils.toString(response.getEntity(), CHARSET_UTF8);</span><br><span class="line">            log.info(<span class="string">&quot;respContent=&#123;&#125;&quot;</span>, respContent);</span><br><span class="line">            <span class="keyword">if</span> (responseClass != <span class="keyword">null</span>) &#123;</span><br><span class="line">                result = JsonUtils.readValue(respContent, responseClass);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;httpClient execute error&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (response != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    EntityUtils.consume(response.getEntity());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;response connection release error&quot;</span>);</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">doPost</span><span class="params">(String path, Map&lt;String, String&gt; headers, String entity, Class&lt;T&gt; responseClass)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        T result = <span class="keyword">null</span>;</span><br><span class="line">        CloseableHttpResponse response = <span class="keyword">null</span>;</span><br><span class="line">        HttpPost httpPost = <span class="keyword">new</span> HttpPost(path);</span><br><span class="line">        <span class="keyword">if</span> (headers != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : headers.entrySet()) &#123;</span><br><span class="line">                httpPost.addHeader(entry.getKey(), entry.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        httpPost.setEntity(<span class="keyword">new</span> StringEntity(entity, Charsets.UTF_8));</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            response = httpClient.execute(httpPost);</span><br><span class="line">            String respContent = EntityUtils.toString(response.getEntity(), CHARSET_UTF8);</span><br><span class="line">            log.info(<span class="string">&quot;respContent=&#123;&#125;&quot;</span>, respContent);</span><br><span class="line">            result = JsonUtils.readValue(respContent, responseClass);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;httpClient execute error&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (response != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    EntityUtils.consume(response.getEntity());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;response connection release error&quot;</span>);</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// put æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;Q, T&gt; <span class="function">T <span class="title">doPut</span><span class="params">(String path, Map&lt;String, String&gt; headers, Q requestObject, Class&lt;T&gt; responseClass)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; params = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        String json = JsonUtils.object2Json(requestObject);</span><br><span class="line">        log.info(<span class="string">&quot;requestContent:&#123;&#125;&quot;</span>, json);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            params = JsonUtils.readValue(json, <span class="keyword">new</span> TypeReference&lt;Map&lt;String, Object&gt;&gt;() &#123;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;json read value error&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> doPut(path, headers, params, responseClass);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">doPut</span><span class="params">(String path, Map&lt;String, String&gt; headers, Map&lt;String, Object&gt; params, Class&lt;T&gt; responseClass)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        T result = <span class="keyword">null</span>;</span><br><span class="line">        CloseableHttpResponse response = <span class="keyword">null</span>;</span><br><span class="line">        HttpPut httpPut = <span class="keyword">new</span> HttpPut(path);</span><br><span class="line">        <span class="keyword">if</span> (headers != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : headers.entrySet()) &#123;</span><br><span class="line">                httpPut.addHeader(entry.getKey(), entry.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        httpPut.addHeader(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">        httpPut.setEntity(<span class="keyword">new</span> StringEntity(JsonUtils.object2Json(params), Charsets.UTF_8));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            response = httpClient.execute(httpPut);</span><br><span class="line">            String respContent = EntityUtils.toString(response.getEntity(), CHARSET_UTF8);</span><br><span class="line">            log.info(<span class="string">&quot;respContent=&#123;&#125;&quot;</span>, respContent);</span><br><span class="line">            respContent = <span class="string">&quot;&#123;\&quot;policies\&quot;:&quot;</span> + respContent + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">            result = JsonUtils.readValue(respContent, responseClass);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;httpClient execute error&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (response != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    EntityUtils.consume(response.getEntity());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;response connection release error&quot;</span>);</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">doGet</span><span class="params">(String uri, Map&lt;String, String&gt; headers, TypeReference&lt;T&gt; type)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        T result = <span class="keyword">null</span>;</span><br><span class="line">        CloseableHttpResponse response = <span class="keyword">null</span>;</span><br><span class="line">        HttpGet httpGet = <span class="keyword">new</span> HttpGet(uri);</span><br><span class="line">        <span class="keyword">if</span> (headers != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : headers.entrySet()) &#123;</span><br><span class="line">                httpGet.addHeader(entry.getKey(), entry.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            response = httpClient.execute(httpGet);</span><br><span class="line">            String respContent = EntityUtils.toString(response.getEntity(), CHARSET_UTF8);</span><br><span class="line">            log.info(<span class="string">&quot;respContent=&#123;&#125;&quot;</span>, respContent);</span><br><span class="line">            <span class="keyword">if</span> (type != <span class="keyword">null</span>) &#123;</span><br><span class="line">                result = JsonUtils.readValue(respContent, type);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;httpClient execute error&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (response != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    EntityUtils.consume(response.getEntity());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;response connection release error&quot;</span>);</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;Q, T&gt; <span class="function">T <span class="title">doDelete</span><span class="params">(String uri, Map&lt;String, String&gt; headers, Q requestObject, Class&lt;T&gt; responseClass)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        T result = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; params = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        String json = JsonUtils.object2Json(requestObject);</span><br><span class="line">        log.info(<span class="string">&quot;requestContent:&#123;&#125;&quot;</span>, json);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            params = JsonUtils.readValue(json, <span class="keyword">new</span> TypeReference&lt;Map&lt;String, String&gt;&gt;() &#123;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;json read value error&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> doDelete(uri, headers, params, responseClass);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">doDelete</span><span class="params">(String uri,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 Map&lt;String, String&gt; headers,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 Map&lt;String, String&gt; params,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 Class&lt;T&gt; responseClass)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        T result = <span class="keyword">null</span>;</span><br><span class="line">        CloseableHttpResponse response = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        HttpDeleteWithBody httpDelete = <span class="keyword">new</span> HttpDeleteWithBody(uri);</span><br><span class="line">        <span class="keyword">if</span> (headers != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : headers.entrySet()) &#123;</span><br><span class="line">                httpDelete.addHeader(entry.getKey(), entry.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        httpDelete.setEntity(<span class="keyword">new</span> StringEntity(JsonUtils.object2Json(params), Charsets.UTF_8));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            response = httpClient.execute(httpDelete);</span><br><span class="line">            String respContent = EntityUtils.toString(response.getEntity(), CHARSET_UTF8);</span><br><span class="line">            log.info(<span class="string">&quot;respContent=&#123;&#125;&quot;</span>, respContent);</span><br><span class="line">            result = JsonUtils.readValue(respContent, responseClass);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;httpClient execute error&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (response != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    EntityUtils.consume(response.getEntity());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;response connection release error&quot;</span>);</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TrustAnyTrustManager</span> <span class="keyword">implements</span> <span class="title">X509TrustManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">TrustAnyTrustManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkClientTrusted</span><span class="params">(X509Certificate[] chain, String authType)</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkServerTrusted</span><span class="params">(X509Certificate[] chain, String authType)</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> X509Certificate[] getAcceptedIssuers() &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> X509Certificate[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/06/09/volatile/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/06/09/volatile/" itemprop="url">volatile</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-06-09T16:55:01+08:00">
                2021-06-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java%E5%A4%9A%E7%BA%BF%E7%A8%8B/" itemprop="url" rel="index">
                    <span itemprop="name">javaå¤šçº¿ç¨‹</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>åœ¨è®²è§£volatileä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹å†…å­˜å¯è§æ€§é—®é¢˜</p>
<p>volatileæ˜¯javaä¸­æ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªå…³é”®å­—ï¼Œå®ƒæ˜¯è½»é‡çº§é”ï¼Œæœ‰ä¸¤ä¸ªä½œç”¨</p>
<blockquote>
<ol>
<li>ä¿è¯å…±äº«å˜é‡åœ¨ä¸åŒçº¿ç¨‹ä¹‹é—´å¯è§</li>
<li>ç¦æ­¢æŒ‡ä»¤é‡æ’åº</li>
</ol>
</blockquote>
<h4 id="å†…å­˜å¯è§æ€§é—®é¢˜"><a href="#å†…å­˜å¯è§æ€§é—®é¢˜" class="headerlink" title="å†…å­˜å¯è§æ€§é—®é¢˜"></a>å†…å­˜å¯è§æ€§é—®é¢˜</h4><p>é¦–å…ˆæ¥çœ‹çœ‹åœ¨å¤šçº¿ç¨‹ä¸‹å¤„ç†å…±äº«å˜é‡çš„javaå†…å­˜æ¨¡å‹ï¼š</p>
<p><img src="/2021/06/09/volatile/javaMM.jpg" alt="javaMM"></p>
<blockquote>
<p>Javaå†…å­˜æ¨¡å‹è§„å®šï¼Œå°†æ‰€æœ‰çš„å˜é‡éƒ½å­˜æ”¾åœ¨ä¸»å†…å­˜ä¸­ï¼Œå½“çº¿ç¨‹ä½¿ç”¨å˜é‡æ—¶ï¼Œä¼šæŠŠä¸»å†…å­˜é‡Œé¢çš„å˜é‡å¤åˆ¶åˆ°è‡ªå·±çš„å·¥ä½œç©ºé—´æˆ–è€…å«ä½œå·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹è¯»å†™å˜é‡æ—¶æ“ä½œçš„æ˜¯è‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ã€‚</p>
</blockquote>
<p>Javaå†…å­˜æ¨¡å‹æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼Œé‚£ä¹ˆåœ¨å®é™…å®ç°ä¸­çº¿ç¨‹çš„å·¥ä½œå†…å­˜æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿçœ‹ä¸‹å›¾ï¼š</p>
<p><img src="/2021/06/09/volatile/javaMMF.png" alt="javaMMF"></p>
<p>å›¾ä¸­æ‰€ç¤ºæ˜¯ä¸€ä¸ªåŒæ ¸CPUç³»ç»Ÿæ¶æ„ï¼Œæ¯ä¸ªæ ¸æœ‰è‡ªå·±çš„æ§åˆ¶å™¨å’Œè¿ç®—å™¨ï¼Œå…¶ä¸­æ§åˆ¶å™¨åŒ…å«ä¸€ç»„å¯„å­˜å™¨å’Œæ“ä½œæ§åˆ¶å™¨ï¼Œè¿ç®—å™¨æ‰§è¡Œç®—æœ¯é€»è¾‘è¿ç®—ã€‚æ¯ä¸ªæ ¸éƒ½æœ‰è‡ªå·±çš„ä¸€çº§ç¼“å­˜ï¼Œåœ¨æœ‰äº›æ¶æ„é‡Œé¢è¿˜æœ‰ä¸€ä¸ªæ‰€æœ‰CPUéƒ½å…±äº«çš„äºŒçº§ç¼“å­˜ã€‚</p>
<p>é‚£ä¹ˆ<strong>Javaå†…å­˜æ¨¡å‹é‡Œé¢çš„å·¥ä½œå†…å­˜ï¼Œå°±å¯¹åº”è¿™é‡Œçš„L1æˆ–è€…L2ç¼“å­˜æˆ–è€…CPUçš„å¯„å­˜å™¨</strong>ã€‚</p>
<p>å½“ä¸€ä¸ªçº¿ç¨‹æ“ä½œå…±äº«å˜é‡æ—¶ï¼Œå®ƒé¦–å…ˆä»ä¸»å†…å­˜å¤åˆ¶å…±äº«å˜é‡åˆ°è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œç„¶åå¯¹å·¥ä½œå†…å­˜é‡Œçš„å˜é‡è¿›è¡Œå¤„ç†ï¼Œå¤„ç†å®Œåå°†å˜é‡å€¼æ›´æ–°åˆ°ä¸»å†…å­˜ã€‚</p>
<p>é‚£ä¹ˆå‡å¦‚çº¿ç¨‹Aå’Œçº¿ç¨‹BåŒæ—¶å¤„ç†ä¸€ä¸ªå…±äº«å˜é‡ï¼Œä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µï¼Ÿæˆ‘ä»¬ä½¿ç”¨å›¾2æ‰€ç¤ºCPUæ¶æ„ï¼Œå‡è®¾çº¿ç¨‹Aå’Œçº¿ç¨‹Bä½¿ç”¨ä¸åŒCPUæ‰§è¡Œï¼Œå¹¶ä¸”å½“å‰ä¸¤çº§Cacheéƒ½ä¸ºç©ºï¼Œé‚£ä¹ˆè¿™æ—¶å€™ç”±äºCacheçš„å­˜åœ¨ï¼Œå°†ä¼šå¯¼è‡´å†…å­˜ä¸å¯è§é—®é¢˜ï¼Œå…·ä½“çœ‹ä¸‹é¢çš„åˆ†æï¼š</p>
<ul>
<li>çº¿ç¨‹Aé¦–å…ˆè·å–å…±äº«å˜é‡1çš„å€¼ï¼Œç”±äºä¸¤çº§Cacheéƒ½æ²¡æœ‰å‘½ä¸­ï¼Œæ‰€ä»¥åŠ è½½ä¸»å†…å­˜ä¸­1çš„å€¼ï¼Œå‡å¦‚ä¸º0ã€‚ç„¶åæŠŠvar1=0çš„å€¼ç¼“å­˜åˆ°ä¸¤çº§ç¼“å­˜ï¼Œçº¿ç¨‹Aä¿®æ”¹var1çš„å€¼ä¸º1ï¼Œç„¶åå°†å…¶å†™å…¥ä¸¤çº§Cacheï¼Œå¹¶ä¸”åˆ·æ–°åˆ°ä¸»å†…å­˜ã€‚çº¿ç¨‹Aæ“ä½œå®Œæ¯•åï¼Œçº¿ç¨‹Aæ‰€åœ¨çš„CPUçš„ä¸¤çº§Cacheå†…å’Œä¸»å†…å­˜é‡Œé¢çš„var1çš„å€¼éƒ½æ˜¯1ã€‚</li>
<li>çº¿ç¨‹Bè·å–var1çš„å€¼ï¼Œé¦–å…ˆä¸€çº§ç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼Œç„¶åçœ‹äºŒçº§ç¼“å­˜ï¼ŒäºŒçº§ç¼“å­˜å‘½ä¸­äº†ï¼Œæ‰€ä»¥è¿”å›var1= 1ï¼›åˆ°è¿™é‡Œä¸€åˆ‡éƒ½æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºè¿™æ—¶å€™ä¸»å†…å­˜ä¸­ä¹Ÿæ˜¯var1=1ã€‚ç„¶åçº¿ç¨‹Bä¿®æ”¹var1çš„å€¼ä¸º2ï¼Œå¹¶å°†å…¶å­˜æ”¾åˆ°çº¿ç¨‹2æ‰€åœ¨çš„ä¸€çº§Cacheå’Œå…±äº«äºŒçº§Cacheä¸­ï¼Œæœ€åæ›´æ–°ä¸»å†…å­˜ä¸­var1çš„å€¼ä¸º2ï¼Œåˆ°è¿™é‡Œä¸€åˆ‡éƒ½æ˜¯å¥½çš„ã€‚</li>
<li>çº¿ç¨‹Aè¿™æ¬¡åˆéœ€è¦ä¿®æ”¹var1çš„å€¼ï¼Œè·å–æ—¶ä¸€çº§ç¼“å­˜å‘½ä¸­ï¼Œå¹¶ä¸”var1=1ï¼Œåˆ°è¿™é‡Œé—®é¢˜å°±å‡ºç°äº†ï¼Œæ˜æ˜çº¿ç¨‹Bå·²ç»æŠŠvar1çš„å€¼ä¿®æ”¹ä¸ºäº†2ï¼Œä¸ºä½•çº¿ç¨‹Aè·å–çš„è¿˜æ˜¯1å‘¢ï¼Ÿè¿™å°±æ˜¯å…±äº«å˜é‡çš„å†…å­˜ä¸å¯è§é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹Bå†™å…¥çš„å€¼å¯¹çº¿ç¨‹Aä¸å¯è§ã€‚</li>
</ul>
<p>åœ¨javaä¸­ï¼Œvolatileå…³é”®å­—å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆè§£å†³çš„ï¼š</p>
<h4 id="volatileç‰¹æ€§ä¸€ï¼šä¿è¯å…±äº«å˜é‡å†…å­˜å¯è§"><a href="#volatileç‰¹æ€§ä¸€ï¼šä¿è¯å…±äº«å˜é‡å†…å­˜å¯è§" class="headerlink" title="volatileç‰¹æ€§ä¸€ï¼šä¿è¯å…±äº«å˜é‡å†…å­˜å¯è§"></a>volatileç‰¹æ€§ä¸€ï¼šä¿è¯å…±äº«å˜é‡å†…å­˜å¯è§</h4><p>volatileå…·ä½“æ˜¯æ€ä¹ˆå®ç°å…±äº«å˜é‡çº¿ç¨‹é—´å¯è§çš„å‘¢ï¼Ÿç®€å•æ¥è¯´å¯ä»¥åˆ†ä¸ºä¸¤ç‚¹ï¼š</p>
<ol>
<li><p>å½“ä¸€ä¸ªå˜é‡è¢«å£°æ˜ä¸ºvolatileæ—¶ï¼Œçº¿ç¨‹åœ¨å†™å…¥å˜é‡æ—¶ä¸ä¼šæŠŠå€¼ç¼“å­˜åœ¨å¯„å­˜å™¨æˆ–è€…å…¶ä»–åœ°æ–¹,è€Œæ˜¯ä¼šæŠŠå€¼åˆ·æ–°å›ä¸»å†…å­˜ã€‚</p>
</li>
<li><p>å½“å…¶ä»–çº¿ç¨‹è¯»å–è¯¥å…±äº«å˜é‡æ—¶ï¼Œä¼šä»ä¸»å†…å­˜é‡æ–°è·å–æœ€æ–°å€¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å½“å‰çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­çš„å€¼ã€‚</p>
</li>
</ol>
<h4 id="volatileç‰¹æ€§äºŒï¼šç¦æ­¢æŒ‡ä»¤é‡æ’åº"><a href="#volatileç‰¹æ€§äºŒï¼šç¦æ­¢æŒ‡ä»¤é‡æ’åº" class="headerlink" title="volatileç‰¹æ€§äºŒï¼šç¦æ­¢æŒ‡ä»¤é‡æ’åº"></a>volatileç‰¹æ€§äºŒï¼šç¦æ­¢æŒ‡ä»¤é‡æ’åº</h4><h4 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h4><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå½“å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªå…±äº«å˜é‡çš„æ—¶å€™ï¼Œå°±æœ‰å¯èƒ½å‘ç”Ÿçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œvolatileä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå®ƒèƒ½ä¿è¯å¯è§æ€§ï¼Œä½†æ— æ³•ä¿è¯åŸå­æ€§ã€‚</p>
<blockquote>
<p>æ‰€è°“åŸå­æ€§æ“ä½œï¼Œæ˜¯æŒ‡æ‰§è¡Œä¸€ç³»åˆ—æ“ä½œæ—¶ï¼Œè¿™äº›æ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œï¼Œä¸å­˜åœ¨åªæ‰§è¡Œå…¶ä¸­ä¸€éƒ¨åˆ†çš„æƒ…å†µã€‚</p>
</blockquote>
<p>ä»€ä¹ˆæ—¶å€™ä¸‹é€‚åˆä½¿ç”¨volatileå‘¢ï¼Ÿ</p>
<ol>
<li><p>å†™å…¥å˜é‡ä¸ä¾èµ–å˜é‡çš„å½“å‰å€¼ï¼Œä¾‹å¦‚ i ++ è¿™ç§æ“ä½œå°±ä¸é€‚åˆä½¿ç”¨volatileä¿®é¥°ï¼Œå› ä¸ºå®ƒä¾èµ– i çš„å½“å‰å€¼ï¼Œæ˜¯</p>
<p><strong>è·å–â€”â€”è®¡ç®—â€”â€”å†™å…¥</strong>ä¸‰æ­¥æ“ä½œï¼Œè¿™ä¸‰æ­¥æ“ä½œä¸æ˜¯åŸå­æ€§çš„ã€‚</p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/06/07/ThreadLocal/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/06/07/ThreadLocal/" itemprop="url">ThreadLocal</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-06-07T15:34:22+08:00">
                2021-06-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java%E5%A4%9A%E7%BA%BF%E7%A8%8B/" itemprop="url" rel="index">
                    <span itemprop="name">javaå¤šçº¿ç¨‹</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/27/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/27/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" itemprop="url">å•ä¾‹æ¨¡å¼</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-05-27T10:59:10+08:00">
                2021-05-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index">
                    <span itemprop="name">è®¾è®¡æ¨¡å¼</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>23ç§è®¾è®¡æ¨¡å¼ä¸­ï¼Œå•ä¾‹æ¨¡å¼æ˜¯æ¯”è¾ƒç®€å•å¹¶ä¸”è¾ƒä¸ºå¸¸ç”¨çš„ä¸€ç§ã€‚</p>
<blockquote>
<p>ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼ï¼Ÿ</p>
<p>å•ä¾‹æ¨¡å¼çš„ç‰¹ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>é¥¿æ±‰å¼ä¸€å®šæ¯”æ‡’æ±‰å¼å·®å—ï¼Ÿ</p>
<p>å•ä¾‹æ¨¡å¼æ˜¯å¦å­˜åœ¨ç¼ºé™·ï¼Ÿæœ‰æ²¡æœ‰æ›¿ä»£æ–¹æ¡ˆï¼Ÿ</p>
</blockquote>
<h5 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h5><p>å®šä¹‰å¾ˆç®€å•ï¼Œä¸€ä¸ªç±»åªå…è®¸åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å°±æ˜¯å•ä¾‹ç±»ï¼Œè¿™ç§æ¨¡å¼å°±æ˜¯å•ä¾‹æ¨¡å¼ã€‚</p>
<blockquote>
<p>å®šä¹‰ä¸­æåˆ°ï¼Œâ€œä¸€ä¸ªç±»åªå…è®¸åˆ›å»ºå”¯ä¸€ä¸€ä¸ªå¯¹è±¡â€ã€‚é‚£å¯¹è±¡çš„å”¯ä¸€æ€§çš„ä½œç”¨èŒƒå›´æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ˜¯æŒ‡çº¿ç¨‹å†…åªå…è®¸åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè¿˜æ˜¯æŒ‡è¿›ç¨‹å†…åªå…è®¸åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Ÿç­”æ¡ˆæ˜¯åè€…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå•ä¾‹æ¨¡å¼åˆ›å»ºçš„å¯¹è±¡æ˜¯è¿›ç¨‹å”¯ä¸€çš„ã€‚å•ä¾‹ç±»ä¸­å¯¹è±¡çš„å”¯ä¸€æ€§çš„ä½œç”¨èŒƒå›´æ˜¯è¿›ç¨‹å†…çš„ï¼Œåœ¨è¿›ç¨‹é—´æ˜¯ä¸å”¯ä¸€çš„ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬é‡ç‚¹çœ‹ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å•ä¾‹è¿™ç§è®¾è®¡æ¨¡å¼ï¼Ÿå®ƒèƒ½è§£å†³å“ªäº›é—®é¢˜ï¼Ÿæ¥ä¸‹æ¥æˆ‘é€šè¿‡ä¸¤ä¸ªå®æˆ˜æ¡ˆä¾‹æ¥è®²è§£ã€‚</p>
<h6 id="æ¡ˆä¾‹ä¸€ï¼šå¤„ç†èµ„æºè®¿é—®å†²çª"><a href="#æ¡ˆä¾‹ä¸€ï¼šå¤„ç†èµ„æºè®¿é—®å†²çª" class="headerlink" title="æ¡ˆä¾‹ä¸€ï¼šå¤„ç†èµ„æºè®¿é—®å†²çª"></a>æ¡ˆä¾‹ä¸€ï¼šå¤„ç†èµ„æºè®¿é—®å†²çª</h6><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰å®ç°äº†ä¸€ä¸ªå¾€æ–‡ä»¶ä¸­æ‰“å°æ—¥å¿—çš„ Logger ç±»ã€‚å…·ä½“çš„ä»£ç å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> FileWriter writer;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Logger</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    File file = <span class="keyword">new</span> File(<span class="string">&quot;/Users/wangzheng/log.txt&quot;</span>);</span><br><span class="line">    writer = <span class="keyword">new</span> FileWriter(file, <span class="keyword">true</span>); <span class="comment">//trueè¡¨ç¤ºè¿½åŠ å†™å…¥</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">    writer.write(mesasge);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Loggerç±»çš„åº”ç”¨ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Logger logger = <span class="keyword">new</span> Logger();</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...çœç•¥ä¸šåŠ¡é€»è¾‘ä»£ç ...</span></span><br><span class="line">    logger.log(username + <span class="string">&quot; logined!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderController</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Logger logger = <span class="keyword">new</span> Logger();</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">create</span><span class="params">(OrderVo order)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...çœç•¥ä¸šåŠ¡é€»è¾‘ä»£ç ...</span></span><br><span class="line">    logger.log(<span class="string">&quot;Created an order: &quot;</span> + order.toString());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢è¿™æ®µä»£ç æ˜¯æœ‰é—®é¢˜çš„</p>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°ï¼Œæ‰€æœ‰çš„æ—¥å¿—éƒ½å†™å…¥åˆ°åŒä¸€ä¸ªæ–‡ä»¶ /Users/wangzheng/log.txt ä¸­ã€‚åœ¨ UserController å’Œ OrderController ä¸­ï¼Œæˆ‘ä»¬åˆ†åˆ«åˆ›å»ºä¸¤ä¸ª Logger å¯¹è±¡ã€‚<strong>åœ¨ Web å®¹å™¨çš„ Servlet å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¦‚æœä¸¤ä¸ª Servlet çº¿ç¨‹åŒæ—¶åˆ†åˆ«æ‰§è¡Œ login() å’Œ create() ä¸¤ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”åŒæ—¶å†™æ—¥å¿—åˆ° log.txt æ–‡ä»¶ä¸­ï¼Œé‚£å°±æœ‰å¯èƒ½å­˜åœ¨æ—¥å¿—ä¿¡æ¯äº’ç›¸è¦†ç›–çš„æƒ…å†µã€‚</strong></p>
<p>å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬æœ€å…ˆæƒ³åˆ°çš„å¯èƒ½å°±æ˜¯åŠ é”ï¼Œç»™log()å‡½æ•°åŠ äº’æ–¥é”ï¼ŒåŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨æ‰§è¡Œ log() å‡½æ•°ã€‚å…·ä½“çš„ä»£ç å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> FileWriter writer;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Logger</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    File file = <span class="keyword">new</span> File(<span class="string">&quot;/Users/wangzheng/log.txt&quot;</span>);</span><br><span class="line">    writer = <span class="keyword">new</span> FileWriter(file, <span class="keyword">true</span>); <span class="comment">//trueè¡¨ç¤ºè¿½åŠ å†™å…¥</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span>(<span class="keyword">this</span>) &#123; <span class="comment">// this ä»£è¡¨å¯¹è±¡çº§åˆ«çš„é”</span></span><br><span class="line">      writer.write(mesasge);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ï¼Œè¿™çœŸçš„èƒ½è§£å†³å¤šçº¿ç¨‹å†™å…¥æ—¥å¿—æ—¶ç›¸äº’è¦†ç›–çš„é—®é¢˜å—ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œè¿™æ˜¯å› ä¸ºï¼Œè¿™ç§é”æ˜¯ä¸€<strong>ä¸ªå¯¹è±¡çº§åˆ«</strong>çš„é”ï¼Œä¸€ä¸ªå¯¹è±¡åœ¨ä¸åŒçš„çº¿ç¨‹ä¸‹åŒæ—¶è°ƒç”¨ log() å‡½æ•°ï¼Œä¼šè¢«å¼ºåˆ¶è¦æ±‚é¡ºåºæ‰§è¡Œã€‚ä½†æ˜¯ï¼Œä¸åŒçš„å¯¹è±¡ä¹‹é—´å¹¶ä¸å…±äº«åŒä¸€æŠŠé”ã€‚åœ¨ä¸åŒçš„çº¿ç¨‹ä¸‹ï¼Œé€šè¿‡ä¸åŒçš„å¯¹è±¡è°ƒç”¨æ‰§è¡Œ log() å‡½æ•°ï¼Œé”å¹¶ä¸ä¼šèµ·ä½œç”¨ï¼Œä»ç„¶æœ‰å¯èƒ½å­˜åœ¨å†™å…¥æ—¥å¿—äº’ç›¸è¦†ç›–çš„é—®é¢˜ã€‚</p>
<p>å®é™…ä¸Šï¼Œè¦æƒ³è§£å†³è¿™ä¸ªé—®é¢˜ä¹Ÿä¸éš¾ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠå¯¹è±¡çº§åˆ«çš„é”ï¼Œæ¢æˆç±»çº§åˆ«çš„é”å°±å¯ä»¥äº†ã€‚è®©æ‰€æœ‰çš„å¯¹è±¡éƒ½å…±äº«åŒä¸€æŠŠé”ã€‚è¿™æ ·å°±é¿å…äº†ä¸åŒå¯¹è±¡ä¹‹é—´åŒæ—¶è°ƒç”¨ log() å‡½æ•°ï¼Œè€Œå¯¼è‡´çš„æ—¥å¿—è¦†ç›–é—®é¢˜ã€‚å…·ä½“çš„ä»£ç å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> FileWriter writer;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Logger</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    File file = <span class="keyword">new</span> File(<span class="string">&quot;/Users/wangzheng/log.txt&quot;</span>);</span><br><span class="line">    writer = <span class="keyword">new</span> FileWriter(file, <span class="keyword">true</span>); <span class="comment">//trueè¡¨ç¤ºè¿½åŠ å†™å…¥</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span>(Logger.class) &#123; <span class="comment">// ç±»çº§åˆ«çš„é”</span></span><br><span class="line">      writer.write(mesasge);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é™¤äº†ä½¿ç”¨<strong>ç±»çº§åˆ«é”</strong>ä¹‹å¤–ï¼Œå®é™…ä¸Šï¼Œ<strong>è§£å†³èµ„æºç«äº‰é—®é¢˜</strong>çš„åŠæ³•è¿˜æœ‰å¾ˆå¤šï¼Œ<strong>åˆ†å¸ƒå¼é”</strong>æ˜¯æœ€å¸¸å¬åˆ°çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚ä¸è¿‡ï¼Œå®ç°ä¸€ä¸ªå®‰å…¨å¯é ã€æ—  bugã€é«˜æ€§èƒ½çš„åˆ†å¸ƒå¼é”ï¼Œå¹¶ä¸æ˜¯ä»¶å®¹æ˜“çš„äº‹æƒ…ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œ<strong>å¹¶å‘é˜Ÿåˆ—</strong>ï¼ˆæ¯”å¦‚ Java ä¸­çš„ BlockingQueueï¼‰ä¹Ÿå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶å¾€å¹¶å‘é˜Ÿåˆ—é‡Œå†™æ—¥å¿—ï¼Œä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹è´Ÿè´£å°†å¹¶å‘é˜Ÿåˆ—ä¸­çš„æ•°æ®ï¼Œå†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶ã€‚è¿™ç§æ–¹å¼å®ç°èµ·æ¥ä¹Ÿç¨å¾®æœ‰ç‚¹å¤æ‚ã€‚</p>
<p>ç›¸å¯¹äºè¿™ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼Œå•ä¾‹æ¨¡å¼çš„è§£å†³æ€è·¯å°±ç®€å•ä¸€äº›äº†ã€‚æˆ‘ä»¬å°† Logger è®¾è®¡æˆä¸€ä¸ªå•ä¾‹ç±»ï¼Œ<strong>ç¨‹åºä¸­åªå…è®¸åˆ›å»ºä¸€ä¸ª Logger å¯¹è±¡</strong>ï¼Œæ‰€æœ‰çš„çº¿ç¨‹å…±äº«ä½¿ç”¨çš„è¿™ä¸€ä¸ª Logger å¯¹è±¡ï¼Œå…±äº«ä¸€ä¸ª FileWriter å¯¹è±¡ï¼Œè€Œ FileWriter æœ¬èº«æ˜¯å¯¹è±¡çº§åˆ«çº¿ç¨‹å®‰å…¨çš„ï¼Œä¹Ÿå°±é¿å…äº†å¤šçº¿ç¨‹æƒ…å†µä¸‹å†™æ—¥å¿—ä¼šäº’ç›¸è¦†ç›–çš„é—®é¢˜ã€‚**(ä¸€ä¸ªå¯¹è±¡åœ¨ä¸åŒçš„çº¿ç¨‹ä¸‹è°ƒç”¨logï¼ˆï¼‰å‡½æ•°ï¼Œä¼šè¢«å¼ºåˆ¶è¦æ±‚é¡ºåºæ‰§è¡Œã€‚)**</p>
<p>æŒ‰ç…§è¿™ä¸ªè®¾è®¡æ€è·¯ï¼Œæˆ‘ä»¬å®ç°äº† Logger å•ä¾‹ç±»ã€‚å…·ä½“ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> FileWriter writer;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger instance = <span class="keyword">new</span> Logger();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">Logger</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    File file = <span class="keyword">new</span> File(<span class="string">&quot;/Users/wangzheng/log.txt&quot;</span>);</span><br><span class="line">    writer = <span class="keyword">new</span> FileWriter(file, <span class="keyword">true</span>); <span class="comment">//trueè¡¨ç¤ºè¿½åŠ å†™å…¥</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Logger <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">    writer.write(mesasge);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Loggerç±»çš„åº”ç”¨ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...çœç•¥ä¸šåŠ¡é€»è¾‘ä»£ç ...</span></span><br><span class="line">    Logger.getInstance().log(username + <span class="string">&quot; logined!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderController</span> </span>&#123;  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">create</span><span class="params">(OrderVo order)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...çœç•¥ä¸šåŠ¡é€»è¾‘ä»£ç ...</span></span><br><span class="line">    Logger.getInstance().log(<span class="string">&quot;Created a order: &quot;</span> + order.toString());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="æ¡ˆä¾‹äºŒï¼šè¡¨ç¤ºå…¨å±€å”¯ä¸€ç±»"><a href="#æ¡ˆä¾‹äºŒï¼šè¡¨ç¤ºå…¨å±€å”¯ä¸€ç±»" class="headerlink" title="æ¡ˆä¾‹äºŒï¼šè¡¨ç¤ºå…¨å±€å”¯ä¸€ç±»"></a>æ¡ˆä¾‹äºŒï¼šè¡¨ç¤ºå…¨å±€å”¯ä¸€ç±»</h6><p>ä»ä¸šåŠ¡æ¦‚å¿µä¸Šï¼Œå¦‚æœæœ‰äº›æ•°æ®åœ¨ç³»ç»Ÿä¸­åªåº”ä¿å­˜ä¸€ä»½ï¼Œé‚£å°±æ¯”è¾ƒé€‚åˆè®¾è®¡ä¸ºå•ä¾‹ç±»ã€‚</p>
<p>æ¯”å¦‚ï¼Œé…ç½®ä¿¡æ¯ç±»ã€‚åœ¨ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå½“é…ç½®æ–‡ä»¶è¢«åŠ è½½åˆ°å†…å­˜ä¹‹åï¼Œä»¥å¯¹è±¡çš„å½¢å¼å­˜åœ¨ï¼Œä¹Ÿç†æ‰€åº”å½“åªæœ‰ä¸€ä»½ã€‚</p>
<p>å†æ¯”å¦‚ï¼Œå”¯ä¸€é€’å¢ ID å·ç ç”Ÿæˆå™¨ï¼Œå¦‚æœç¨‹åºä¸­æœ‰ä¸¤ä¸ªå¯¹è±¡ï¼Œé‚£å°±ä¼šå­˜åœ¨ç”Ÿæˆé‡å¤ ID çš„æƒ…å†µï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åº”è¯¥å°† ID ç”Ÿæˆå™¨ç±»è®¾è®¡ä¸ºå•ä¾‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicLong;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IdGenerator</span> </span>&#123;</span><br><span class="line">  <span class="comment">// AtomicLongæ˜¯ä¸€ä¸ªJavaå¹¶å‘åº“ä¸­æä¾›çš„ä¸€ä¸ªåŸå­å˜é‡ç±»å‹,</span></span><br><span class="line">  <span class="comment">// å®ƒå°†ä¸€äº›çº¿ç¨‹ä¸å®‰å…¨éœ€è¦åŠ é”çš„å¤åˆæ“ä½œå°è£…ä¸ºäº†çº¿ç¨‹å®‰å…¨çš„åŸå­æ“ä½œï¼Œ</span></span><br><span class="line">  <span class="comment">// æ¯”å¦‚ä¸‹é¢ä¼šç”¨åˆ°çš„incrementAndGet().</span></span><br><span class="line">  <span class="keyword">private</span> AtomicLong id = <span class="keyword">new</span> AtomicLong(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> IdGenerator instance = <span class="keyword">new</span> IdGenerator();</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">IdGenerator</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IdGenerator <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> id.incrementAndGet();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// IdGeneratorä½¿ç”¨ä¸¾ä¾‹</span></span><br><span class="line"><span class="keyword">long</span> id = IdGenerator.getInstance().getId();</span><br></pre></td></tr></table></figure>



<h5 id="å¦‚ä½•å®ç°ä¸€ä¸ªå•ä¾‹"><a href="#å¦‚ä½•å®ç°ä¸€ä¸ªå•ä¾‹" class="headerlink" title="å¦‚ä½•å®ç°ä¸€ä¸ªå•ä¾‹"></a>å¦‚ä½•å®ç°ä¸€ä¸ªå•ä¾‹</h5><p>è¦å®ç°ä¸€ä¸ªå•ä¾‹ï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨çš„ç‚¹æ— å¤–ä¹ä¸‹é¢å‡ ä¸ªï¼š</p>
<ul>
<li>æ„é€ å‡½æ•°éœ€è¦æ˜¯ private è®¿é—®æƒé™çš„ï¼Œè¿™æ ·æ‰èƒ½é¿å…å¤–éƒ¨é€šè¿‡ new åˆ›å»ºå®ä¾‹ï¼›</li>
<li>è€ƒè™‘å¯¹è±¡åˆ›å»ºæ—¶çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼›</li>
<li>è€ƒè™‘æ˜¯å¦æ”¯æŒå»¶è¿ŸåŠ è½½ï¼›</li>
<li>è€ƒè™‘ getInstance() æ€§èƒ½æ˜¯å¦é«˜ï¼ˆæ˜¯å¦åŠ é”ï¼‰ã€‚</li>
</ul>
<h6 id="é¥¿æ±‰å¼"><a href="#é¥¿æ±‰å¼" class="headerlink" title="é¥¿æ±‰å¼"></a>é¥¿æ±‰å¼</h6><p>é¥¿æ±‰å¼çš„å®ç°æ–¹å¼æ¯”è¾ƒç®€å•ã€‚åœ¨ç±»åŠ è½½çš„æ—¶å€™ï¼Œinstance é™æ€å®ä¾‹å°±å·²ç»åˆ›å»ºå¹¶åˆå§‹åŒ–å¥½äº†ï¼Œæ‰€ä»¥ï¼Œinstance å®ä¾‹çš„åˆ›å»ºè¿‡ç¨‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä¸è¿‡ï¼Œè¿™æ ·çš„å®ç°æ–¹å¼ä¸æ”¯æŒå»¶è¿ŸåŠ è½½ï¼ˆåœ¨çœŸæ­£ç”¨åˆ° IdGenerator çš„æ—¶å€™ï¼Œå†åˆ›å»ºå®ä¾‹ï¼‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IdGenerator</span> </span>&#123; </span><br><span class="line">  <span class="keyword">private</span> AtomicLong id = <span class="keyword">new</span> AtomicLong(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> IdGenerator instance = <span class="keyword">new</span> IdGenerator();</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">IdGenerator</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IdGenerator <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> id.incrementAndGet();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿‡å»ï¼Œæˆ‘ä¸€ç›´è§‰å¾—é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼æ˜¯å¾ˆlowçš„å•ä¾‹ï¼Œå› ä¸ºå®ƒå®ç°èµ·æ¥å¾ˆç®€å•ï¼Œå¹¶ä¸”ä¸æ”¯æŒå»¶è¿ŸåŠ è½½ã€‚ä½†æ˜¯ï¼Œä»”ç»†æƒ³æƒ³ï¼Œé¥¿æ±‰å¼çœŸå°±ä¸å¦‚å…¶ä»–å‡ ç§å®ç°æ–¹å¼å—ï¼Ÿå¦‚æœå®ä¾‹å ç”¨èµ„æºå¤šï¼ˆæ¯”å¦‚å ç”¨å†…å­˜å¤šï¼‰æˆ–åˆå§‹åŒ–è€—æ—¶é•¿ï¼ˆæ¯”å¦‚éœ€è¦åŠ è½½å„ç§é…ç½®æ–‡ä»¶ï¼‰ï¼Œé‚£ä¹ˆæ ¹æ®fail-fast çš„è®¾è®¡åŸåˆ™ï¼ˆæœ‰é—®é¢˜åŠæ—©æš´éœ²ï¼‰ï¼Œé‚£æˆ‘ä»¬ä¹Ÿå¸Œæœ›åœ¨ç¨‹åºå¯åŠ¨æ—¶å°±å°†è¿™ä¸ªå®ä¾‹åˆå§‹åŒ–å¥½ï¼Œä»¥ä¾¿æˆ‘ä»¬åŠæ—¶ä¿®å¤ã€‚</p>
<h6 id="æ‡’æ±‰å¼"><a href="#æ‡’æ±‰å¼" class="headerlink" title="æ‡’æ±‰å¼"></a>æ‡’æ±‰å¼</h6><p>æ‡’æ±‰å¼ç›¸å¯¹äºé¥¿æ±‰å¼çš„ä¼˜åŠ¿æ˜¯æ”¯æŒå»¶è¿ŸåŠ è½½ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IdGenerator</span> </span>&#123; </span><br><span class="line">  <span class="keyword">private</span> AtomicLong id = <span class="keyword">new</span> AtomicLong(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> IdGenerator instance;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">IdGenerator</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> IdGenerator <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">     	 instance = <span class="keyword">new</span> IdGenerator();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> id.incrementAndGet();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="åŒé‡æ£€æµ‹"><a href="#åŒé‡æ£€æµ‹" class="headerlink" title="åŒé‡æ£€æµ‹"></a>åŒé‡æ£€æµ‹</h6><p>åŒé‡æ£€æµ‹æ¨¡å¼æ˜¯å¯¹é¥¿æ±‰å¼ã€æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ç¼ºé™·çš„è¡¥å……ï¼Œé¥¿æ±‰å¼ä¸æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Œæ‡’æ±‰å¼ç”±äºåŠ äº†ä¸€æŠŠå¤§é”ï¼Œå¦‚æœé¢‘ç¹ä½¿ç”¨è¿™ä¸ªç±»ï¼Œé‚£é¢‘ç¹åŠ é”ã€é‡Šæ”¾é”åŠå¹¶å‘åº¦ä½ç­‰é—®é¢˜ï¼Œä¼šå¯¼è‡´æ€§èƒ½ç“¶é¢ˆï¼Œæ‰€ä»¥å°±æœ‰äº†åŒé‡æ£€æµ‹æ¨¡å¼ï¼Œæ—¢æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Œåˆæ”¯æŒé«˜å¹¶å‘çš„å•ä¾‹å®ç°æ–¹å¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IdGenerator</span> </span>&#123; </span><br><span class="line">  <span class="keyword">private</span> AtomicLong id = <span class="keyword">new</span> AtomicLong(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> IdGenerator instance;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">IdGenerator</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IdGenerator <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123; <span class="comment">// ç¬¬ä¸€é‡æ£€æµ‹ï¼Œå¦‚æœ==nullï¼ŒåŠ é”</span></span><br><span class="line">      	<span class="keyword">synchronized</span>(IdGenerator.class) &#123; <span class="comment">// ç±»çº§åˆ«çš„é”</span></span><br><span class="line">       		<span class="keyword">if</span>ï¼ˆinstance == <span class="keyword">null</span>ï¼‰ &#123; <span class="comment">// ç¬¬äºŒé‡æ£€æµ‹</span></span><br><span class="line">          		instance = <span class="keyword">new</span> IdGenerator();</span><br><span class="line">          &#125;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> id.incrementAndGet();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="é™æ€å†…éƒ¨ç±»"><a href="#é™æ€å†…éƒ¨ç±»" class="headerlink" title="é™æ€å†…éƒ¨ç±»"></a>é™æ€å†…éƒ¨ç±»</h6><p>æœ‰ç‚¹ç±»ä¼¼äºé¥¿æ±‰å¼ï¼Œä½†åˆèƒ½åšåˆ°å»¶è¿ŸåŠ è½½</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IdGenerator</span> </span>&#123; </span><br><span class="line">  <span class="keyword">private</span> AtomicLong id = <span class="keyword">new</span> AtomicLong(<span class="number">0</span>);</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">IdGenerator</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> IdGenerator instance = <span class="keyword">new</span> IdGenerator();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IdGenerator <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> SingletonHolder.instance;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> id.incrementAndGet();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SingletonHolder æ˜¯ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œå½“å¤–éƒ¨ç±» IdGenerator è¢«åŠ è½½çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šåˆ›å»º SingletonHolder å®ä¾‹å¯¹è±¡ã€‚åªæœ‰å½“è°ƒç”¨ getInstance() æ–¹æ³•æ—¶ï¼ŒSingletonHolder æ‰ä¼šè¢«åŠ è½½ï¼Œè¿™ä¸ªæ—¶å€™æ‰ä¼šåˆ›å»º instanceã€‚instance çš„å”¯ä¸€æ€§ã€åˆ›å»ºè¿‡ç¨‹çš„çº¿ç¨‹å®‰å…¨æ€§ï¼Œéƒ½ç”± JVM æ¥ä¿è¯ã€‚æ‰€ä»¥ï¼Œè¿™ç§å®ç°æ–¹æ³•æ—¢ä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼Œåˆèƒ½åšåˆ°å»¶è¿ŸåŠ è½½ã€‚</p>
<h6 id="æšä¸¾"><a href="#æšä¸¾" class="headerlink" title="æšä¸¾"></a>æšä¸¾</h6><p>æšä¸¾æœ¬èº«çš„ç‰¹æ€§ï¼Œä¿è¯äº†å®ä¾‹åˆ›å»ºçš„çº¿ç¨‹å®‰å…¨æ€§å’Œå®ä¾‹çš„å”¯ä¸€æ€§ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">IdGenerator</span> </span>&#123;</span><br><span class="line">  INSTANCE;</span><br><span class="line">  <span class="keyword">private</span> AtomicLong id = <span class="keyword">new</span> AtomicLong(<span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> id.incrementAndGet();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/25/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/25/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/" itemprop="url">åŠ¨æ€ä»£ç†</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-05-25T17:53:05+08:00">
                2021-05-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index">
                    <span itemprop="name">è®¾è®¡æ¨¡å¼</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>å¦‚æœæœ‰ä¸€ä¸ªHelloæ¥å£ï¼Œæˆ‘ä»¬éœ€è¦å®ç°è¿™ä¸ªæ¥å£ï¼Œé€šå¸¸æƒ…å†µä¸‹æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloImpl</span> <span class="keyword">implements</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span> <span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„HelloImpl.javaæ–‡ä»¶æ˜¯ç”±å¼€å‘äººå‘˜ç¼–å†™çš„ï¼Œè€ŒåŠ¨æ€ä»£ç†è¦å¹²çš„äº‹å°±æ˜¯æˆ‘<strong>ä¸å†™è¿™ä¸ª.javaæ–‡ä»¶ä¹Ÿèƒ½ç”Ÿæˆå®ç°ç±»</strong>ï¼Œç›´æ¥è·³è¿‡ç¼–è¯‘ï¼Œç”Ÿæˆå®ç°ç±»çš„classæ–‡ä»¶ã€‚</p>
<p>javaç±»çš„åŠ è½½è¿‡ç¨‹å¦‚å›¾:</p>
<p><img src="/2021/05/25/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/proxy1.png" alt="proxy1"></p>
<h4 id="javassistå®ç°åŠ¨æ€ä»£ç†"><a href="#javassistå®ç°åŠ¨æ€ä»£ç†" class="headerlink" title="javassistå®ç°åŠ¨æ€ä»£ç†"></a>javassistå®ç°åŠ¨æ€ä»£ç†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyFactory</span> </span>&#123;</span><br><span class="line">		<span class="comment">// ç®€å•å®ç°</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Hello <span class="title">createProxy1</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ClassPool pool = <span class="keyword">new</span> ClassPool();</span><br><span class="line">        pool.appendSystemPath();</span><br><span class="line">      	<span class="comment">// åˆ›å»ºä»£ç†ç±»</span></span><br><span class="line">        CtClass impl = pool.makeClass(<span class="string">&quot;$proxy&quot;</span>);</span><br><span class="line">      	<span class="comment">// å®ç°æ¥å£</span></span><br><span class="line">        impl.addInterface(pool.get(Hello.class.getName()));</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªæ–¹æ³•</span></span><br><span class="line">        CtMethod sayHello = CtNewMethod.make(CtClass.voidType, <span class="string">&quot;sayHello&quot;</span>, <span class="keyword">new</span> CtClass[]&#123;&#125;,</span><br><span class="line">                <span class="keyword">new</span> CtClass[<span class="number">0</span>], <span class="string">&quot;&#123;System.out.println(\&quot;hello world\&quot;);&#125;&quot;</span>,</span><br><span class="line">                impl);</span><br><span class="line">        impl.addMethod(sayHello);</span><br><span class="line">				<span class="comment">// ç”Ÿæˆclassæ–‡ä»¶</span></span><br><span class="line">        Class aClass = pool.toClass(impl);</span><br><span class="line">        <span class="keyword">return</span> (Hello) aClass.newInstance();</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span></span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Hello proxy1 = createProxy1();</span><br><span class="line">        proxy1.sayHello();  <span class="comment">//  è¿è¡Œç»“æœ: hello world</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç å°±æ˜¯ä½¿ç”¨javassistæŠ€æœ¯å®ç°çš„åŠ¨æ€ä»£ç†demoï¼Œä»è¿™ä¸ªdemoä¸­å¯ä»¥å¾ˆæ˜äº†çš„çœ‹åˆ°ï¼Œæˆ‘ä»¬æ²¡æœ‰åˆ›å»ºHelloæ¥å£çš„å®ç°ç±»ï¼Œè€Œæ˜¯ç›´æ¥ç»„è£…äº†Helloæ¥å£å®ç°ç±»çš„<strong>å­—èŠ‚ç æ–‡ä»¶</strong>ï¼ŒåŠ¨æ€ä»£ç†åšåˆ°äº†å³ä½¿æ²¡æœ‰.javaæ–‡ä»¶ï¼Œæˆ‘ä¹Ÿå¯ä»¥ç”Ÿæˆclassæ–‡ä»¶ï¼Œå®Œå…¨ä¸å½±å“æˆ‘ç¨‹åºçš„è¿è¡Œã€‚</p>
<p>ä½†æ˜¯ï¼Œä¸Šé¢çš„ä»£ç è¿˜æœ‰å¾ˆå¤šç¼ºé™·ï¼Œå†™çš„å¾ˆæ­»æ¿ï¼Œæ¯”å¦‚æˆ‘æ¢ä¸ªåˆ«çš„æ¥å£ï¼ŒHello1ï¼ŒHello2ç­‰ç­‰ï¼Œæˆ–è€…è¿˜æ˜¯å®ç°Helloæ¥å£ï¼Œä½†æ˜¯æ–¹æ³•æœ‰å˜äº†ï¼Œæœ‰äº›æ–¹æ³•æœ‰è¿”å›å€¼ï¼Œæœ‰äº›æœ‰å‚æ•°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">     <span class="function"><span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span></span>;</span><br><span class="line">  		<span class="function">String <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line">  		<span class="function"><span class="keyword">void</span> <span class="title">sayByeBye</span><span class="params">(String username)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æƒ³æƒ³ï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬æ€ä¹ˆåŠæ‰å¥½ï¼Ÿæ ¹æ®æ–¹æ³•åä¸€ä¸ªä¸ªåˆ¤æ–­ï¼Ÿè¿™æ˜¾ç„¶æ˜¯ä¸è¡Œçš„ï¼Œåˆ°åº•æ€ä¹ˆåŠæ‰å¥½ï¼Ÿè¯´åˆ°åŠ¨æ€ä»£ç†ï¼Œè®°ä¸è®°å¾—è¿™ä¹ˆä¸ªä¸œè¥¿ï¼Œå®ƒå« InvocationHandlerï¼Œæ˜¯ä¸ªæ¥å£ï¼Œä¹‹å‰ä¸€ç›´ä¸æ˜ç™½è¿™ä¸ªæ¥å£çš„ä½œç”¨ã€‚å…¶å®ï¼ŒInvocationHandlerçš„ä½œç”¨æ˜¯å°†æˆ‘ä»¬è¦ä»£ç†çš„æ¥å£çš„æ–¹æ³•æŠ½è±¡å‡ºæ¥ï¼Œæˆ‘ä»¬å®ç°InvocationHandleræ¥å£ï¼Œå…¶å®å°±æ˜¯åœ¨å®ç°åŠ¨æ€ä»£ç†è¿‡ç¨‹ä¸­æˆ‘ä»¬æ‰€è¦å¢å¼ºçš„ä¸šåŠ¡é€»è¾‘ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">     <span class="comment">// proxy ä»£ç†ç±»</span></span><br><span class="line">  	 <span class="comment">// method æ–¹æ³•å</span></span><br><span class="line">     <span class="comment">// args æ–¹æ³•å‚æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> Throwable</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹ï¼Œjavassistæ¯”è¾ƒå®Œæ•´çš„åŠ¨æ€ä»£ç†æ˜¯å¦‚ä½•å®ç°çš„</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyFactory</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cla     è¢«ä»£ç†æ¥å£</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler æ¥å£å…·ä½“å®ç°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">createProxy</span><span class="params">(Class&lt;T&gt; cla, InvocationHandler handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªç±»</span></span><br><span class="line">        ClassPool pool = <span class="keyword">new</span> ClassPool();</span><br><span class="line">        pool.appendSystemPath(); <span class="comment">// ç›¸å½“äºclassLoader</span></span><br><span class="line">        CtClass impl = pool.makeClass(<span class="string">&quot;$proxy&quot;</span>);</span><br><span class="line">        impl.addInterface(pool.get(cla.getName()));</span><br><span class="line">        <span class="comment">// ç»™ä»£ç†ç±»æ·»åŠ å±æ€§handler</span></span><br><span class="line">        CtField field = CtField.make(<span class="string">&quot;public com.github.yeecode.mybatisdemo.ProxyFactory.InvocationHandler handler=null;&quot;</span>, impl);</span><br><span class="line">        impl.addField(field);</span><br><span class="line">        String src = <span class="string">&quot;return ($r)this.handler.invoke(\&quot;%s\&quot;,$args);&quot;</span>;</span><br><span class="line">        String voidSrc = <span class="string">&quot;this.handler.invoke(\&quot;%s\&quot;,$args);&quot;</span>;</span><br><span class="line">        <span class="comment">// åˆ›å»ºæ¥å£ä¸‹çš„æ‰€æœ‰æ–¹æ³•å®ç°</span></span><br><span class="line">        <span class="keyword">for</span> (Method method : cla.getMethods()) &#123;</span><br><span class="line">            CtClass returnType = pool.get(method.getReturnType().getName());</span><br><span class="line">            String name = method.getName();</span><br><span class="line">            CtClass[] parameters = toCtClass(pool, method.getParameterTypes());</span><br><span class="line">            CtClass[] errors = toCtClass(pool, method.getExceptionTypes());</span><br><span class="line">            String srcImpl = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span> (method.getReturnType().equals(Void.class)) &#123;</span><br><span class="line">                srcImpl = voidSrc;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                srcImpl = src;</span><br><span class="line">            &#125;</span><br><span class="line">            CtMethod newMethod =</span><br><span class="line">                    CtNewMethod.make(returnType, name, parameters, errors, String.format(srcImpl, name), impl);</span><br><span class="line">            impl.addMethod(newMethod);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–</span></span><br><span class="line">        Class aClass = pool.toClass(impl);</span><br><span class="line">        Object o = aClass.newInstance();</span><br><span class="line">        aClass.getField(<span class="string">&quot;handler&quot;</span>).set(o, handler);</span><br><span class="line">        <span class="keyword">return</span> (T) o;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// è‡ªå·±çš„InvocationHandler</span></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">        <span class="function">Object <span class="title">invoke</span><span class="params">(String methodName, Object args[])</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//  Helloæ¥å£</span></span><br><span class="line">     <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span></span>;</span><br><span class="line">        <span class="function">String <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        InvocationHandler handler = <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(String methodName, Object[] args)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (methodName.equals(<span class="string">&quot;sayHello&quot;</span>)) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;hello i am your friends.&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (methodName.equals(<span class="string">&quot;getName&quot;</span>)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;dly&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        Hello proxy = createProxy(Hello.class, handler);</span><br><span class="line">        System.out.println(proxy.getName());  <span class="comment">// dly </span></span><br><span class="line">        proxy.sayHello(); <span class="comment">// hello i am your friends.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥å°†javassistç”Ÿæˆçš„classæ–‡ä»¶ä¿å­˜ä¸‹æ¥ï¼Œçœ‹çœ‹å…¶ä¸­çš„ç±»ç»“æ„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] bytes = impl.toBytecode();</span><br><span class="line">        Files.write(Paths.get(System.getProperty(<span class="string">&quot;user.dir&quot;</span>) + <span class="string">&quot;/target/&quot;</span> + impl.getName() + <span class="string">&quot;.class&quot;</span>), bytes);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.github.yeecode.mybatisdemo.ProxyFactory.Hello;</span><br><span class="line"><span class="keyword">import</span> com.github.yeecode.mybatisdemo.ProxyFactory.InvocationHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> $<span class="title">proxy</span> <span class="keyword">implements</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> InvocationHandler handler = <span class="keyword">null</span>;  <span class="comment">// ä»£ç†ç±»ä¸­æ·»åŠ äº†InvocationHandlerå±æ€§</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (String)<span class="keyword">this</span>.handler.invoke(<span class="string">&quot;getName&quot;</span>, <span class="keyword">new</span> Object[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.handler.invoke(<span class="string">&quot;sayHello&quot;</span>, <span class="keyword">new</span> Object[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $proxy() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="jdkå®ç°åŠ¨æ€ä»£ç†"><a href="#jdkå®ç°åŠ¨æ€ä»£ç†" class="headerlink" title="jdkå®ç°åŠ¨æ€ä»£ç†"></a>jdkå®ç°åŠ¨æ€ä»£ç†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Proxy</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>&#123;</span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@loader</span>  ç±»åŠ è½½å™¨</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@interfaces</span>  è¢«ä»£ç†çš„æ¥å£</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@h</span> InvocationHandlerå®ç°ç±»ï¼Œåœ¨æ­¤ç±»ä¸­å®ç°ä¸šåŠ¡å¢å¼ºé€»è¾‘</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">newProxyInstance</span><span class="params">(ClassLoader loader,</span></span></span><br><span class="line"><span class="function"><span class="params">                                          Class&lt;?&gt;[] interfaces,</span></span></span><br><span class="line"><span class="function"><span class="params">                                          InvocationHandler h)</span></span></span><br><span class="line"><span class="function">  &#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">  <span class="comment">/** </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@proxy</span>  ç”Ÿæˆçš„ä»£ç†å¯¹è±¡ï¼Œå¯ä»¥è¿”å›</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@method</span> è¢«ä»£ç†çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@args</span> æ–¹æ³•å‚æ•°</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> Throwable</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Hello proxy = (Hello) Proxy.newProxyInstance(ProxyFactory.class.getClassLoader(),</span><br><span class="line">                <span class="keyword">new</span> Class[]&#123;Hello.class&#125;,</span><br><span class="line">                <span class="keyword">new</span> java.lang.reflect.InvocationHandler() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                        System.out.println(proxy.getClass());</span><br><span class="line">                        System.out.println(args);</span><br><span class="line">                        <span class="keyword">if</span> (method.getName().equals(<span class="string">&quot;sayHello&quot;</span>)) &#123;</span><br><span class="line">                            System.out.println(<span class="string">&quot;nihao&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">        proxy.sayHello();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span></span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>class com.sun.proxy.$Proxy0<br>null<br>nihao</p>
</blockquote>
<p>jdkæŸ¥çœ‹classæ–‡ä»¶</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String s = <span class="string">&quot;$jdkProxy.class&quot;</span>;</span><br><span class="line"><span class="keyword">byte</span>[] bytes = ProxyGenerator.generateProxyClass(s, <span class="keyword">new</span> Class[]&#123;Hello.class&#125;);</span><br><span class="line">Files.write(Paths.get(System.getProperty(<span class="string">&quot;user.dir&quot;</span>) + <span class="string">&quot;/target/&quot;</span>+s), bytes);</span><br></pre></td></tr></table></figure>

<h4 id="åŠ¨æ€ä»£ç†çš„åº”ç”¨"><a href="#åŠ¨æ€ä»£ç†çš„åº”ç”¨" class="headerlink" title="åŠ¨æ€ä»£ç†çš„åº”ç”¨"></a>åŠ¨æ€ä»£ç†çš„åº”ç”¨</h4><p>åŠ¨æ€ä»£ç†çš„åº”ç”¨å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯å¢å¼ºè¡Œä»£ç†ï¼Œä¸€ç±»æ˜¯é“¾æ¥å‹ä»£ç†ï¼Œå®ƒä¿©çš„åŒºåˆ«åœ¨äºæœ‰æ²¡æœ‰æ”¹å˜ä¸šåŠ¡é€»è¾‘ï¼Œå¦‚æœæ”¹äº†å°±æ˜¯å¢å¼ºå‹ï¼Œæ²¡æœ‰å°±æ˜¯é“¾æ¥å‹ã€‚</p>
<p>å¢å¼ºå‹ä»£ç†</p>
<blockquote>
<p>AOP</p>
<p>æ—¥å¿—æ‰“å°</p>
<p>å£°æ˜å¼äº‹åŠ¡</p>
<p>ç›‘æ§</p>
</blockquote>
<p>é“¾æ¥å‹ä»£ç†</p>
<blockquote>
<p>è¿œç¨‹è°ƒç”¨</p>
<p>Mybatis mapper æ˜ å°„</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/20/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/20/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/" itemprop="url">è´£ä»»é“¾æ¨¡å¼</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-05-20T11:17:45+08:00">
                2021-05-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index">
                    <span itemprop="name">è®¾è®¡æ¨¡å¼</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ä¼—å¤šä¼˜ç§€çš„å¼€æºæ¡†æ¶ä¸­ï¼Œå…¶æºç å¤§é‡ä½¿ç”¨äº†è®¾è®¡æ¨¡å¼ï¼Œå…¶ä¸­è´£ä»»é“¾æ¨¡å¼æ˜¯æ¯”è¾ƒé‡è¦å¹¶ä¸”è¢«å¹¿æ³›ä½¿ç”¨çš„ï¼Œå¦‚æœå¯¹è®¾è®¡æ¨¡å¼ä¸æ¸…æ¥šï¼Œåœ¨é˜…è¯»æºç çš„è¿‡ç¨‹ä¸­å°±å¾ˆå®¹æ˜“è¿·å¤±æ–¹å‘ã€‚</p>
<h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>è´£ä»»é“¾æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<blockquote>
<p>è¿™ç§æ¨¡å¼åœ¨ç»“æ„ä¸Šç”±å¤šä¸ªéƒ¨ä»¶ã€åŸºäºå¼•ç”¨ç»„æˆä¸€ä¸²é“¾æ¡ï¼Œè¡Œä¸ºä¸Šè¯·æ±‚ä»é“¾æ¡çš„å¤´éƒ¨ä¼ é€’åˆ°å„ä¸ªèŠ‚ç‚¹ï¼Œä»è€Œè§¦å‘æ‰§è¡Œå„ä¸ªèŠ‚ç‚¹æ‰€è¦è´Ÿè´£çš„ä¸šåŠ¡é€»è¾‘ã€‚</p>
<p>è´£ä»»é“¾ç”±å¤šä¸ªèŠ‚ç‚¹ï¼ˆå¤„ç†å™¨ï¼‰ç»„æˆã€‚åœ¨è¡Œä¸ºæ¨¡å¼ä¸Šæœ‰ä¸¤ç§ï¼šä¸€ç§ä½¿éå†é“¾æ¡ä¸Šçš„èŠ‚ç‚¹ï¼Œç›´åˆ°æ‰¾åˆ°å¯¹åº”çš„èŠ‚ç‚¹ï¼Œç„¶åå¤„ç†ï¼Œè¿™ç§äº¤ç»å…¸è´£ä»»é“¾æ¨¡å¼ã€‚</p>
<p>å¦ä¸€ç§æ˜¯ç”±å„ä¸ªèŠ‚ç‚¹ä¾æ¬¡å¤„ç†ï¼Œå…±äº«è´Ÿæ‹…è´£ä»»çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬ç§°å®ƒä¸ºå˜ç§è´£ä»»é“¾ã€‚ä¸¤ç§æ¨¡å¼åœ¨ç»“æ„ä¸Šä¹Ÿä¼šä¸ä¸€æ ·ï¼Œå‰è€…åŸºäºæ•°ç»„è¿›è¡Œéå†ï¼Œåè€…é€šè¿‡å¼•ç”¨ç»„æˆé“¾è¡¨ã€‚</p>
</blockquote>
<h4 id="mybatisç¼“å­˜ç¤ºä¾‹"><a href="#mybatisç¼“å­˜ç¤ºä¾‹" class="headerlink" title="mybatisç¼“å­˜ç¤ºä¾‹"></a>mybatisç¼“å­˜ç¤ºä¾‹</h4><p>åœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œç¼“å­˜æ˜¯æ¯”è¾ƒå¸¸è§çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œé€šå¸¸æƒ…å†µä¸‹è¯·æ±‚æ•°æ®æ˜¯ä»æ•°æ®åº“è¯»å–çš„ï¼Œä¸ºäº†åŠ å¿«å“åº”é€Ÿåº¦ï¼Œæˆ‘ä»¬å¼•å…¥ç¼“å­˜ï¼Œè¯·æ±‚æ•°æ®ç›´æ¥ä»å†…å­˜è¿”å›ã€‚</p>
<p>ä¸€ä¸ªç¼“å­˜ç»„ä»¶ï¼Œå…¶åŠŸèƒ½ä¸»è¦æ˜¯å­˜å‚¨ã€è·å–ï¼Œè¾…åŠ©åŠŸèƒ½å¯ä»¥åŒ…æ‹¬è¿‡æœŸåˆ é™¤ã€çº¿ç¨‹å®‰å…¨ã€åºåˆ—åŒ–ã€å‘½ä¸­ç‡ç»Ÿè®¡ç­‰ç­‰ã€‚</p>
<p>mybatisä¸­çš„ç¼“å­˜å®ç°é‡‡ç”¨çš„å°±æ˜¯è´£ä»»é“¾æ¨¡å¼ï¼Œmybatisç¼“å­˜æ˜¯é€šè¿‡åŠ è½½ã€è§£æé…ç½®æ–‡ä»¶ï¼Œç”±Configurationç®¡ç†çš„ã€‚ä¸‹é¢æˆ‘ä»¬å°±çœ‹çœ‹mybatisç¼“å­˜è®¾è®¡å®ç°çš„æºç ï¼š</p>
<p>é¦–å…ˆè§£æé…ç½®æ–‡ä»¶ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XMLConfigBuilder</span> <span class="keyword">extends</span> <span class="title">BaseBuilder</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> parsed;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> XPathParser parser;</span><br><span class="line">    <span class="keyword">private</span> String environment;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReflectorFactory localReflectorFactory;</span><br><span class="line">	<span class="comment">// è¯¥æ–¹æ³•ç”¨æ¥è§£æé…ç½®æ–‡ä»¶</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parseConfiguration</span><span class="params">(XNode root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.propertiesElement(root.evalNode(<span class="string">&quot;properties&quot;</span>));</span><br><span class="line">            Properties settings = <span class="keyword">this</span>.settingsAsProperties(root.evalNode(<span class="string">&quot;settings&quot;</span>));</span><br><span class="line">            <span class="keyword">this</span>.loadCustomVfs(settings);</span><br><span class="line">            <span class="keyword">this</span>.loadCustomLogImpl(settings);</span><br><span class="line">            <span class="keyword">this</span>.typeAliasesElement(root.evalNode(<span class="string">&quot;typeAliases&quot;</span>));</span><br><span class="line">            <span class="keyword">this</span>.pluginElement(root.evalNode(<span class="string">&quot;plugins&quot;</span>));</span><br><span class="line">            <span class="keyword">this</span>.objectFactoryElement(root.evalNode(<span class="string">&quot;objectFactory&quot;</span>));</span><br><span class="line">            <span class="keyword">this</span>.objectWrapperFactoryElement(root.evalNode(<span class="string">&quot;objectWrapperFactory&quot;</span>));</span><br><span class="line">            <span class="keyword">this</span>.reflectorFactoryElement(root.evalNode(<span class="string">&quot;reflectorFactory&quot;</span>));</span><br><span class="line">            <span class="keyword">this</span>.settingsElement(settings);</span><br><span class="line">            <span class="keyword">this</span>.environmentsElement(root.evalNode(<span class="string">&quot;environments&quot;</span>));</span><br><span class="line">            <span class="keyword">this</span>.databaseIdProviderElement(root.evalNode(<span class="string">&quot;databaseIdProvider&quot;</span>));</span><br><span class="line">            <span class="keyword">this</span>.typeHandlerElement(root.evalNode(<span class="string">&quot;typeHandlers&quot;</span>));</span><br><span class="line">            <span class="comment">// è§£æmappersæ ‡ç­¾ï¼Œç¼“å­˜å®ç°åœ¨è¿™é‡Œé¢</span></span><br><span class="line">           <span class="keyword">this</span>.mapperElement(root.evalNode(<span class="string">&quot;mappers&quot;</span>)); </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BuilderException(<span class="string">&quot;Error parsing SQL Mapper Configuration. Cause: &quot;</span> + var3, var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">mapperElement</span><span class="params">(XNode parent)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (resource != <span class="keyword">null</span> &amp;&amp; url == <span class="keyword">null</span> &amp;&amp; mapperClass == <span class="keyword">null</span>) &#123;</span><br><span class="line">                            ErrorContext.instance().resource(resource);</span><br><span class="line">                            inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">                            mapperParser = <span class="keyword">new</span> XMLMapperBuilder(inputStream, <span class="keyword">this</span>.configuration, resource, <span class="keyword">this</span>.configuration.getSqlFragments());</span><br><span class="line">                            mapperParser.parse();  <span class="comment">// è§£æmapperæ–‡ä»¶å…¥å£</span></span><br><span class="line">                        &#125; </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>è§£æmapperæ–‡ä»¶</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XMLMapperBuilder</span> <span class="keyword">extends</span> <span class="title">BaseBuilder</span> </span>&#123;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">parse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.configuration.isResourceLoaded(<span class="keyword">this</span>.resource)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.configurationElement(<span class="keyword">this</span>.parser.evalNode(<span class="string">&quot;/mapper&quot;</span>)); <span class="comment">// å…¥å£</span></span><br><span class="line">            <span class="keyword">this</span>.configuration.addLoadedResource(<span class="keyword">this</span>.resource);</span><br><span class="line">            <span class="keyword">this</span>.bindMapperForNamespace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.parsePendingResultMaps();</span><br><span class="line">        <span class="keyword">this</span>.parsePendingCacheRefs();</span><br><span class="line">        <span class="keyword">this</span>.parsePendingStatements();</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">configurationElement</span><span class="params">(XNode context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String namespace = context.getStringAttribute(<span class="string">&quot;namespace&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (namespace != <span class="keyword">null</span> &amp;&amp; !namespace.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">this</span>.builderAssistant.setCurrentNamespace(namespace);</span><br><span class="line">                <span class="keyword">this</span>.cacheRefElement(context.evalNode(<span class="string">&quot;cache-ref&quot;</span>));</span><br><span class="line">                <span class="comment">// åœ¨è§£æcacheæ ‡ç­¾</span></span><br><span class="line">                <span class="keyword">this</span>.cacheElement(context.evalNode(<span class="string">&quot;cache&quot;</span>)); </span><br><span class="line">                <span class="keyword">this</span>.parameterMapElement(context.evalNodes(<span class="string">&quot;/mapper/parameterMap&quot;</span>));</span><br><span class="line">                <span class="keyword">this</span>.resultMapElements(context.evalNodes(<span class="string">&quot;/mapper/resultMap&quot;</span>));</span><br><span class="line">                <span class="keyword">this</span>.sqlElement(context.evalNodes(<span class="string">&quot;/mapper/sql&quot;</span>));</span><br><span class="line">                <span class="keyword">this</span>.buildStatementFromContext(context.evalNodes(<span class="string">&quot;select|insert|update|delete&quot;</span>));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> BuilderException(<span class="string">&quot;Mapper&#x27;s namespace cannot be empty&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BuilderException(<span class="string">&quot;Error parsing Mapper XML. The XML location is &#x27;&quot;</span> + <span class="keyword">this</span>.resource + <span class="string">&quot;&#x27;. Cause: &quot;</span> + var3, var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿™ä¸ªæ–¹æ³•ç”¨æ¥è®¾ç½®ç¼“å­˜å‚æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">cacheElement</span><span class="params">(XNode context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (context != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// PERPETUAL ä»£è¡¨ä½¿ç”¨cacheæ¥å£å®ç°ç±» PerpetualCache</span></span><br><span class="line">            String type = context.getStringAttribute(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;PERPETUAL&quot;</span>);</span><br><span class="line">            Class&lt;? extends Cache&gt; typeClass = <span class="keyword">this</span>.typeAliasRegistry.resolveAlias(type);</span><br><span class="line">            <span class="comment">// LRU  cacheæ·˜æ±°æœºåˆ¶å®ç°ç±»   é»˜è®¤æ˜¯FifoCache</span></span><br><span class="line">            String eviction = context.getStringAttribute(<span class="string">&quot;eviction&quot;</span>, <span class="string">&quot;LRU&quot;</span>);</span><br><span class="line">            Class&lt;? extends Cache&gt; evictionClass = <span class="keyword">this</span>.typeAliasRegistry.resolveAlias(eviction);</span><br><span class="line">            Long flushInterval = context.getLongAttribute(<span class="string">&quot;flushInterval&quot;</span>);</span><br><span class="line">            Integer size = context.getIntAttribute(<span class="string">&quot;size&quot;</span>);</span><br><span class="line">            <span class="keyword">boolean</span> readWrite = !context.getBooleanAttribute(<span class="string">&quot;readOnly&quot;</span>, <span class="keyword">false</span>);</span><br><span class="line">            <span class="keyword">boolean</span> blocking = context.getBooleanAttribute(<span class="string">&quot;blocking&quot;</span>, <span class="keyword">false</span>);</span><br><span class="line">            Properties props = context.getChildrenAsProperties();</span><br><span class="line">           <span class="comment">// æ„å»ºç¼“å­˜</span></span><br><span class="line">          <span class="keyword">this</span>.builderAssistant.useNewCache(typeClass, evictionClass, flushInterval, size, readWrite, blocking, props);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapperBuilderAssistant</span> <span class="keyword">extends</span> <span class="title">BaseBuilder</span> </span>&#123;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> Cache <span class="title">useNewCache</span><span class="params">(Class&lt;? extends Cache&gt; typeClass, Class&lt;? extends Cache&gt; evictionClass, Long flushInterval, Integer size, <span class="keyword">boolean</span> readWrite, <span class="keyword">boolean</span> blocking, Properties props)</span> </span>&#123;</span><br><span class="line">        Cache cache = (<span class="keyword">new</span> CacheBuilder(<span class="keyword">this</span>.currentNamespace)).implementation((Class)<span class="keyword">this</span>.valueOrDefault(typeClass, PerpetualCache.class)).addDecorator((Class)<span class="keyword">this</span>.valueOrDefault(evictionClass, LruCache.class)).clearInterval(flushInterval).size(size).readWrite(readWrite).blocking(blocking).properties(props).build(); <span class="comment">// build cache </span></span><br><span class="line">        <span class="keyword">this</span>.configuration.addCache(cache);</span><br><span class="line">        <span class="keyword">this</span>.currentCache = cache;</span><br><span class="line">        <span class="keyword">return</span> cache;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheBuilder</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CacheBuilder</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.decorators = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CacheBuilder <span class="title">implementation</span><span class="params">(Class&lt;? extends Cache&gt; implementation)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.implementation = implementation;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  	</span><br><span class="line">		<span class="function"><span class="keyword">public</span> Cache <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setDefaultImplementations();</span><br><span class="line">        Cache cache = <span class="keyword">this</span>.newBaseCacheInstance(<span class="keyword">this</span>.implementation, <span class="keyword">this</span>.id);</span><br><span class="line">        <span class="keyword">this</span>.setCacheProperties((Cache)cache);</span><br><span class="line">        <span class="keyword">if</span> (PerpetualCache.class.equals(cache.getClass())) &#123;</span><br><span class="line">            Iterator var2 = <span class="keyword">this</span>.decorators.iterator();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(var2.hasNext()) &#123;</span><br><span class="line">                Class&lt;? extends Cache&gt; decorator = (Class)var2.next();</span><br><span class="line">                cache = <span class="keyword">this</span>.newCacheDecoratorInstance(decorator, (Cache)cache);</span><br><span class="line">                <span class="keyword">this</span>.setCacheProperties((Cache)cache);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            cache = <span class="keyword">this</span>.setStandardDecorators((Cache)cache);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!LoggingCache.class.isAssignableFrom(cache.getClass())) &#123;</span><br><span class="line">            cache = <span class="keyword">new</span> LoggingCache((Cache)cache);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (Cache)cache;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">private</span> Cache <span class="title">setStandardDecorators</span><span class="params">(Cache cache)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            MetaObject metaCache = SystemMetaObject.forObject(cache);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.size != <span class="keyword">null</span> &amp;&amp; metaCache.hasSetter(<span class="string">&quot;size&quot;</span>)) &#123;</span><br><span class="line">                metaCache.setValue(<span class="string">&quot;size&quot;</span>, <span class="keyword">this</span>.size);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.clearInterval != <span class="keyword">null</span>) &#123;</span><br><span class="line">                cache = <span class="keyword">new</span> ScheduledCache((Cache)cache);</span><br><span class="line">                ((ScheduledCache)cache).setClearInterval(<span class="keyword">this</span>.clearInterval);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.readWrite) &#123;</span><br><span class="line">                cache = <span class="keyword">new</span> SerializedCache((Cache)cache);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Cache cache = <span class="keyword">new</span> LoggingCache((Cache)cache);</span><br><span class="line">            cache = <span class="keyword">new</span> SynchronizedCache(cache);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.blocking) &#123;</span><br><span class="line">                cache = <span class="keyword">new</span> BlockingCache((Cache)cache);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> (Cache)cache;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> CacheException(<span class="string">&quot;Error building standard cache decorators.  Cause: &quot;</span> + var3, var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ€»è€Œè¨€ä¹‹ï¼Œmybatisä¸­cacheç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2021/05/20/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/cache1.png" alt="cache1"></p>
<p>Cacheæœ‰å¾ˆå¤šå®ç°ç±»ï¼Œæ¯ä¸ªå®ç°ç±»éƒ½æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œå¹¶ä¸”ä½¿ç”¨deletateå±æ€§ï¼Œä½¿å¼•ç”¨æŒ‡å‘ä¸‹ä¸€ä¸ªå®ç°ç±»ä»è€Œè¡Œæˆä¸€æ¡å¼•ç”¨é“¾æ¡ï¼Œæœ€ç»ˆå­˜å‚¨æ•°æ®çš„å…¶å®æ˜¯PerpetualCacheä¸­çš„map.</p>
<h4 id="é—®é¢˜ä¸€ï¼š"><a href="#é—®é¢˜ä¸€ï¼š" class="headerlink" title="é—®é¢˜ä¸€ï¼š"></a>é—®é¢˜ä¸€ï¼š</h4><p>â€‹    æˆ‘ä»¬å¹³å¸¸æ‰€çœ‹åˆ°çš„Filterã€Interceptorã€pipelineè¿™äº›éƒ½å±äºè´£ä»»é“¾æ¨¡å¼å—ï¼Ÿå¦‚æœæ˜¯è¯·è¯´å‡ºä½ åœ¨å“ªäº›æ¡†æ¶æºç ä¸­æœ‰è§è¿‡è¿™äº›åœºæ™¯?ä»–ä»¬å±äºç»å…¸è´£ä»»é“¾æ¨¡å¼ï¼Œè¿˜æ˜¯å˜ç§è´£ä»»é“¾ï¼Ÿ</p>
<h4 id="é—®é¢˜äºŒï¼š"><a href="#é—®é¢˜äºŒï¼š" class="headerlink" title="é—®é¢˜äºŒï¼š"></a>é—®é¢˜äºŒï¼š</h4><p>â€‹    åŸºäºä»¥ä¸‹åœºæ™¯è®¾è®¡ä¸€ä¸ªç»å…¸è´£ä»»é“¾æ¨¡å¼ã€‚</p>
<p>â€‹    è¯·å‡å®¡æ‰¹æµç¨‹ï¼š1å¤©ä»¥å†…ç”±HRç›´æ¥å®¡æ‰¹ï¼Œ2åˆ°3å¤©ç”±éƒ¨é—¨ä¸»ç®¡å®¡æ‰¹ï¼Œä¸‰å¤©ä»¥ä¸Šç”±ç»ç†è¿›è¡Œå®¡æ‰¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Approve</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String HR = <span class="string">&quot;hr&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEPARTMENT = <span class="string">&quot;department&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MANAGER = <span class="string">&quot;manager&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å½“å‰å®¡æ‰¹äººå®¡æ‰¹æœ€å¤§å¤©æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxDay;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è´£ä»»é“¾ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">    <span class="keyword">protected</span> Approve nextApprove;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Approve</span><span class="params">(<span class="keyword">int</span> maxDay)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.maxDay = maxDay;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®¡æ‰¹</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">approve</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">approveDays</span><span class="params">(<span class="keyword">int</span> day)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (day &lt;= maxDay) &#123;</span><br><span class="line">            approve();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (nextApprove != <span class="keyword">null</span>) &#123;</span><br><span class="line">                nextApprove.approveDays(day);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;mmp,æ²¡äººæ‰¹ã€‚ã€‚ã€‚&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNextApprove</span><span class="params">(Approve nextApprove)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.nextApprove = nextApprove;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HRApprove</span> <span class="keyword">extends</span> <span class="title">Approve</span> </span>&#123;</span><br><span class="line"> 		<span class="function"><span class="keyword">public</span> <span class="title">HRApprove</span><span class="params">(<span class="keyword">int</span> maxDay)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(maxDay);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">approve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(HRApprove.HR + <span class="string">&quot;å®¡æ‰¹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DepartmentApprove</span> <span class="keyword">extends</span> <span class="title">Approve</span> </span>&#123;</span><br><span class="line">  	 <span class="function"><span class="keyword">public</span> <span class="title">DepartmentApprove</span><span class="params">(<span class="keyword">int</span> maxDay)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(maxDay);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">approve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(HRApprove.DEPARTMENT + <span class="string">&quot;å®¡æ‰¹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ManagerApprove</span> <span class="keyword">extends</span> <span class="title">Approve</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ManagerApprove</span><span class="params">(<span class="keyword">int</span> maxDay)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(maxDay);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">approve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(HRApprove.MANAGER + <span class="string">&quot;å®¡æ‰¹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">int</span> day = <span class="number">22</span>;</span><br><span class="line">      Approve hrApprove = <span class="keyword">new</span> HRApprove(<span class="number">1</span>);</span><br><span class="line">      Approve departmentApprove = <span class="keyword">new</span> DepartmentApprove(<span class="number">3</span>);</span><br><span class="line">      Approve managerApprove = <span class="keyword">new</span> ManagerApprove(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è®¾ç½®ä¸Šçº§å¼•ç”¨</span></span><br><span class="line">      hrApprove.setNextApprove(departmentApprove);</span><br><span class="line">      departmentApprove.setNextApprove(managerApprove);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å®¡æ‰¹</span></span><br><span class="line">      hrApprove.approveDays(day);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">25</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">åˆ†ç±»</span>
                </a>
              </div>
            

            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">dly</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
